<!-- ============ ðŸŽ¨ PALETTE DESIGNER â€” WIZARD MOBILE (SCREENS + SNAP) ============ -->
<style>
  :root{
    --pd-bg: rgba(10,11,16,.94);
    --pd-card: rgba(255,255,255,.06);
    --pd-ring: rgba(255,255,255,.14);
    --pd-ink:#eef2ff; --pd-muted:#9fafcd;
    --pd-acc:#2bd9ff; --pd-acc2:#ff3cac;
  }
  @media (prefers-color-scheme: light){
    :root{ --pd-bg: rgba(250,252,255,.98); --pd-card: rgba(0,0,0,.06); --pd-ring: rgba(0,0,0,.12); --pd-ink:#0e1116; --pd-muted:#586274 }
  }

  .pdw{ position:fixed; inset:0; z-index:99999; background:var(--pd-bg);
        color:var(--pd-ink); display:grid; grid-template-rows:auto 1fr auto;
        font: clamp(16px,4.2vw,18px)/1.55 Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
  .pd-hidden{ display:none }

  /* Header simple */
  .pdw-top{ display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding: clamp(12px,4vw,18px); border-bottom:1px solid var(--pd-ring); background:var(--pd-card); }
  .pdw-title{ font-weight:800; letter-spacing:.2px }
  .pd-btn{ appearance:none; border:1px solid var(--pd-ring); background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.04));
           color:inherit; border-radius:14px; padding:12px 16px; font-weight:700; min-height:44px; min-width:44px; }
  .pd-btn.primary{ background:linear-gradient(180deg, color-mix(in oklab, var(--pd-acc) 26%, transparent), transparent);
                    box-shadow:0 8px 28px color-mix(in oklab, var(--pd-acc) 22%, transparent) }

  /* Screens (wizard) */
  .pdw-screens{ position:relative; overflow:auto; scroll-snap-type:y mandatory; -webkit-overflow-scrolling:touch; }
  .screen{ min-height:100svh; padding: clamp(16px,5vw,22px); display:grid; align-content:center; gap:16px;
           scroll-snap-align:start; }
  .card{ background:var(--pd-card); border:1px solid var(--pd-ring); border-radius:16px; padding: clamp(14px,4.5vw,18px); display:grid; gap:12px }
  .card h2{ margin:0; font-weight:800; font-size: clamp(18px,6vw,22px) }
  .sub{ color:var(--pd-muted) }

  /* Wheel */
  .wheel-wrap{ display:grid; place-items:center; gap:14px }
  .wheel{ width:min(84vw, 360px); aspect-ratio:1/1; border-radius:50%;
          border:1px solid var(--pd-ring); background:radial-gradient(circle, rgba(255,255,255,.05), transparent 60%);
          position:relative; touch-action:none; }
  .wheel canvas{ width:100%; height:100%; display:block }
  .knob{ position:absolute; width:24px; height:24px; border-radius:50%; background:#fff; border:2px solid #111;
         transform:translate(-50%,-50%); box-shadow:0 0 0 5px rgba(0,0,0,.18); pointer-events:none }

  .sliders{ width:100%; max-width: 420px; margin-inline:auto; display:grid; gap:12px }
  .sliders label{ color:var(--pd-muted) }
  .sliders input[type="range"]{ width:100%; height:48px; appearance:none; background:transparent; touch-action:manipulation }
  .sliders input[type="range"]::-webkit-slider-runnable-track{ height:10px; border-radius:999px;
       background:linear-gradient(90deg, var(--pd-acc), var(--pd-acc2)) }
  .sliders input[type="range"]::-webkit-slider-thumb{ appearance:none; width:32px; height:32px; border-radius:50%; background:#fff; border:2px solid #111; margin-top:-11px }
  .sliders input[type="range"]::-moz-range-track{ height:10px; border-radius:999px; background:linear-gradient(90deg, var(--pd-acc), var(--pd-acc2)) }
  .sliders input[type="range"]::-moz-range-thumb{ width:32px; height:32px; border-radius:50%; background:#fff; border:2px solid #111 }

  /* Modes */
  .chips{ display:flex; flex-wrap:wrap; gap:10px }
  .chip{ padding:12px 14px; border-radius:14px; border:1px solid var(--pd-ring);
         background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
         min-height:44px; font-weight:700 }
  .chip.active{ outline:2px solid color-mix(in oklab, var(--pd-acc) 30%, transparent) }

  /* Swatches */
  .grid{ display:grid; grid-template-columns:repeat(3, 1fr); gap:12px }
  @media (min-width: 680px){ .grid{ grid-template-columns:repeat(5, 1fr) } }
  .sw{ border:1px solid var(--pd-ring); border-radius:14px; overflow:hidden; background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
       display:grid; grid-template-rows: 80px auto }
  .sw .box{ min-height:80px }
  .meta{ padding:10px; display:grid; gap:6px }
  .row{ display:flex; align-items:center; justify-content:space-between; gap:10px }
  .copy{ padding:10px 12px; border-radius:10px; border:1px solid var(--pd-ring); background:transparent; min-height:40px; font-weight:700 }
  .small{ color:var(--pd-muted); font-size:.95em; word-break:break-all }

  /* Contrast & tokens */
  .preview{ display:grid; grid-template-columns:1fr; gap:12px }
  @media (min-width: 780px){ .preview{ grid-template-columns:1fr 1fr } }
  .demo{ border:1px solid var(--pd-ring); border-radius:12px; overflow:hidden }
  .demo header{ display:flex; justify-content:space-between; gap:8px; padding:10px 12px; color:var(--pd-muted);
                border-bottom:1px solid var(--pd-ring) }
  .demo .box{ min-height:76px; padding:12px; font-weight:800 }

  .tokens{ width:100%; min-height:140px; font: 13px/1.5 ui-monospace, Menlo, Consolas, monospace;
           background:transparent; color:var(--pd-ink); border:1px dashed var(--pd-ring); border-radius:12px; padding:12px }

  /* Footer (nav) */
  .pdw-foot{ display:flex; align-items:center; justify-content:space-between; gap:12px;
             padding: clamp(12px,4vw,18px); border-top:1px solid var(--pd-ring); background:var(--pd-card); }
  .dots{ display:flex; gap:8px }
  .dot{ width:10px; height:10px; border-radius:50%; background:color-mix(in oklab, var(--pd-ink) 22%, transparent); }
  .dot.on{ background:linear-gradient(180deg, var(--pd-acc), var(--pd-acc2)); box-shadow:0 0 10px color-mix(in oklab, var(--pd-acc) 30%, transparent) }
</style>

<div class="pdw" id="pdw" role="dialog" aria-label="Concepteur de palettes â€” wizard mobile">
  <div class="pdw-top">
    <div class="pdw-title">ðŸŽ¨ Palette â€” Wizard</div>
    <div class="pdw-actions">
      <button class="pd-btn" id="btnRand">AlÃ©atoire</button>
      <button class="pd-btn primary" id="btnApply">Appliquer</button>
      <button class="pd-btn" id="btnClose">Fermer</button>
    </div>
  </div>

  <!-- Screens -->
  <div class="pdw-screens" id="screens" aria-live="polite">
    <!-- 1. Wheel -->
    <section class="screen" id="s1">
      <div class="card">
        <h2>1 Â· Teinte</h2>
        <div class="sub">Tourne la roue (du doigt) puis ajuste Saturation & LuminositÃ©.</div>
        <div class="wheel-wrap">
          <div class="wheel" id="wheelWrap">
            <canvas id="wheel"></canvas>
            <div class="knob" id="knob"></div>
          </div>
          <div class="sliders">
            <label for="sat">Saturation</label>
            <input id="sat" type="range" min="0" max="100" value="80" />
            <label for="lig">LuminositÃ©</label>
            <input id="lig" type="range" min="0" max="100" value="55" />
          </div>
        </div>
      </div>
    </section>

    <!-- 2. Modes -->
    <section class="screen" id="s2">
      <div class="card">
        <h2>2 Â· Harmonies</h2>
        <div class="sub">Choisis un schÃ©ma : complÃ©mentaire, triade, tÃ©trade, analogues ou monochrome.</div>
        <div class="chips" id="modes">
          <button class="chip" data-mode="complement">ComplÃ©mentaire</button>
          <button class="chip" data-mode="triad">Triade</button>
          <button class="chip" data-mode="tetrad">TÃ©trade</button>
          <button class="chip" data-mode="analog">Analogues</button>
          <button class="chip" data-mode="mono">Monochrome</button>
        </div>
      </div>
    </section>

    <!-- 3. Swatches -->
    <section class="screen" id="s3">
      <div class="card">
        <h2>3 Â· Couleurs proposÃ©es</h2>
        <div class="grid" id="grid"></div>
      </div>
    </section>

    <!-- 4. Contraste & tokens -->
    <section class="screen" id="s4">
      <div class="card">
        <h2>4 Â· Contraste & Tokens</h2>
        <div class="preview">
          <div class="demo">
            <header><span>Fond clair</span><span id="AA1">â€”</span></header>
            <div class="box" id="DL" style="background:#ffffff; color:#111">Aa â€” Titre & bouton</div>
          </div>
          <div class="demo">
            <header><span>Fond sombre</span><span id="AA2">â€”</span></header>
            <div class="box" id="DD" style="background:#0a0b10; color:#eef2ff">Aa â€” Titre & bouton</div>
          </div>
        </div>
        <textarea class="tokens" id="tokens" readonly></textarea>
      </div>
    </section>
  </div>

  <div class="pdw-foot">
    <div class="dots" id="dots">
      <div class="dot on"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
    </div>
    <div class="nav">
      <button class="pd-btn" id="prev">â—„ PrÃ©cÃ©dent</button>
      <button class="pd-btn primary" id="next">Suivant â–º</button>
    </div>
  </div>
</div>

<script>
(()=> {
  /* ==== helpers ==== */
  const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
  const hslToRgb=(h,s,l)=>{ s/=100; l/=100; const k=n=>(n+(h/30))%12; const a=s*Math.min(l,1-l);
    const f=n=> l - a*Math.max(-1, Math.min(k(n)-3, Math.min(9-k(n),1)));
    return [Math.round(255*f(0)),Math.round(255*f(8)),Math.round(255*f(4))] };
  const rgbToHex=(r,g,b)=>'#'+[r,g,b].map(x=>x.toString(16).padStart(2,'0')).join('');
  const hslToHex=(h,s,l)=>rgbToHex(...hslToRgb(h,s,l));
  const hexToRgb=(hex)=>{ const m=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex); return m?[parseInt(m[1],16),parseInt(m[2],16),parseInt(m[3],16)]:[0,0,0] };
  const luminance=(r,g,b)=>{ const t=[r,g,b].map(v=>{v/=255; return v<=.03928?v/12.92:Math.pow((v+0.055)/1.055,2.4)}); return 0.2126*t[0]+0.7152*t[1]+0.0722*t[2] };
  const ratio=(c1,c2)=>{ const [r1,g1,b1]=hexToRgb(c1),[r2,g2,b2]=hexToRgb(c2); const L1=luminance(r1,g1,b1)+0.05, L2=luminance(r2,g2,b2)+0.05; return Math.round(((L1>L2?L1/L2:L2/L1))*100)/100 };
  const wcag=r=> r>=7?'AAA': r>=4.5?'AA': r>=3?'AA (large)':'fail';
  const rot=(h,d)=>(((h+d)%360)+360)%360;

  /* ==== DOM ==== */
  const wrap = document.getElementById('pdw');
  const screens = document.getElementById('screens');
  const dots = Array.from(document.getElementById('dots').children);
  const prev = document.getElementById('prev');
  const next = document.getElementById('next');
  const btnClose = document.getElementById('btnClose');
  const btnApply = document.getElementById('btnApply');
  const btnRand = document.getElementById('btnRand');

  const grid = document.getElementById('grid');
  const tokens = document.getElementById('tokens');
  const AA1 = document.getElementById('AA1');
  const AA2 = document.getElementById('AA2');
  const DL  = document.getElementById('DL');
  const DD  = document.getElementById('DD');

  const modes = document.getElementById('modes');

  /* ==== wheel ==== */
  const wheelWrap = document.getElementById('wheelWrap');
  const wheel = document.getElementById('wheel');
  const knob = document.getElementById('knob');
  const sat = document.getElementById('sat');
  const lig = document.getElementById('lig');

  let H=200, S=80, L=55, MODE='complement', step=0;
  let dpr = Math.min(window.devicePixelRatio || 1, 2);

  function drawWheel(){
    const size = Math.floor(wheelWrap.clientWidth * dpr);
    if(size<=0) return;
    wheel.width = size; wheel.height=size;
    const ctx = wheel.getContext('2d');
    const r=size/2, cx=r, cy=r;
    ctx.clearRect(0,0,size,size);
    for(let deg=0;deg<360;deg++){
      const g=ctx.createRadialGradient(cx,cy, r*0.18, cx,cy, r*0.98);
      g.addColorStop(0, hslToHex(deg,20,50));
      g.addColorStop(1, hslToHex(deg,100,50));
      ctx.strokeStyle=g; ctx.beginPath();
      const a1=(deg-1)*Math.PI/180, a2=deg*Math.PI/180;
      ctx.arc(cx,cy,r-2,a1,a2); ctx.lineWidth=Math.max(14*dpr, 12); ctx.stroke();
    }
    ctx.beginPath(); ctx.arc(cx,cy,r*0.2,0,Math.PI*2);
    ctx.fillStyle='rgba(255,255,255,.08)'; ctx.fill();
    positionKnob();
  }
  function positionKnob(){
    const rect = wheelWrap.getBoundingClientRect();
    const r = rect.width/2;
    const ang = (H-90)*Math.PI/180;
    knob.style.left = (rect.width/2 + (r-16)*Math.cos(ang))+'px';
    knob.style.top  = (rect.height/2 + (r-16)*Math.sin(ang))+'px';
  }
  function hueFromPointer(x,y){
    const rect = wheelWrap.getBoundingClientRect();
    const dx = x - rect.left - rect.width/2;
    const dy = y - rect.top  - rect.height/2;
    H = (Math.round(Math.atan2(dy,dx)*180/Math.PI + 90) + 360) % 360;
    render();
  }
  let dragging=false;
  wheelWrap.addEventListener('pointerdown', e=>{ dragging=true; wheelWrap.setPointerCapture(e.pointerId); hueFromPointer(e.clientX,e.clientY) });
  wheelWrap.addEventListener('pointermove', e=>{ if(dragging) hueFromPointer(e.clientX,e.clientY) });
  wheelWrap.addEventListener('pointerup',   e=>{ dragging=false; try{wheelWrap.releasePointerCapture(e.pointerId)}catch{} });

  sat.addEventListener('input', e=>{ S=+e.target.value; render() });
  lig.addEventListener('input', e=>{ L=+e.target.value; render() });

  // Modes chips
  modes.querySelectorAll('.chip').forEach(b=>{
    if(b.dataset.mode==='complement') b.classList.add('active');
    b.addEventListener('click', ()=>{
      modes.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
      b.classList.add('active'); MODE=b.dataset.mode; render();
    });
  });

  // Palette builder
  function buildSet(){
    let set=[];
    if(MODE==='complement'){ set=[[H,S,L],[rot(H,180),S,L]]; }
    else if(MODE==='triad'){ set=[[H,S,L],[rot(H,120),S,L],[rot(H,-120),S,L]]; }
    else if(MODE==='tetrad'){ set=[[H,S,L],[rot(H,90),S,L],[rot(H,180),S,L],[rot(H,270),S,L]]; }
    else if(MODE==='analog'){ set=[[rot(H,-30),S,L],[H,S,L],[rot(H,15),S,L],[rot(H,30),S,L]]; }
    else if(MODE==='mono'){ set=[[H,S,clamp(L-20,0,100)],[H,S,L],[H,S,clamp(L+20,0,100)]]; }
    while(set.length<5){ set.push([H,S,clamp(L+(set.length-2)*10,0,100)]) }
    return set.slice(0,5);
  }

  // Render
  function render(){
    positionKnob();
    grid.innerHTML='';
    const set = buildSet();
    set.forEach(([h,s,l],i)=>{
      const hex=hslToHex(h,s,l);
      const el=document.createElement('div');
      el.className='sw';
      el.innerHTML=`<div class="box" style="background:${hex}"></div>
        <div class="meta">
          <div class="row"><b>${i===0?'base':'var'+i}</b><button class="copy" data-copy="${hex}">Copier</button></div>
          <div class="small">${hex.toUpperCase()} â€¢ hsl(${h}, ${s}%, ${l}%)</div>
        </div>`;
      grid.appendChild(el);
    });
    grid.querySelectorAll('[data-copy]').forEach(b=>{
      b.onclick=()=> navigator.clipboard.writeText(b.dataset.copy);
      b.onpointerdown=(e)=>{ let t=setTimeout(()=>b.click(), 500); ['pointerup','pointercancel','pointerleave'].forEach(ev=>b.addEventListener(ev,()=>clearTimeout(t),{once:true})) };
    });

    const primary = hslToHex(H,S,L);
    DL.style.color=primary; DD.style.color=primary;
    AA1.textContent='Contraste: '+wcag(ratio(primary,'#ffffff'));
    AA2.textContent='Contraste: '+wcag(ratio(primary,'#0a0b10'));

    tokens.value = `:root{
  --acc: ${primary};
  --acc-2: ${hslToHex(rot(H,180),S,L)};
  --acc-tri-1: ${hslToHex(rot(H,120),S,L)};
  --acc-tri-2: ${hslToHex(rot(H,-120),S,L)};
  --acc-analog-1: ${hslToHex(rot(H,15),S,L)};
  --acc-analog-2: ${hslToHex(rot(H,-15),S,L)};
}`;
  }

  // Random palettes
  const curated=[
    ['Vaporwave',[315,80,65],'triad'],
    ['Tropical', [170,75,50],'analog'],
    ['Arcade',   [200,90,55],'tetrad'],
    ['Sunset',   [18,85,58], 'complement'],
    ['Aurora',   [155,70,54],'analog'],
    ['Sakura',   [340,70,66],'mono'],
    ['Cyber',    [190,90,55],'tetrad'],
  ];
  function randomize(){
    if(Math.random()<0.6){
      const [_,[h,s,l],mode]=curated[Math.floor(Math.random()*curated.length)];
      H=h; S=s; L=l; MODE=mode;
    }else{
      H=Math.floor(Math.random()*360);
      S=[65,70,75,80,85][Math.floor(Math.random()*5)];
      L=[48,52,56,60,64][Math.floor(Math.random()*5)];
      MODE=['complement','triad','tetrad','analog','mono'][Math.floor(Math.random()*5)];
    }
    modes.querySelectorAll('.chip').forEach(x=>x.classList.toggle('active', x.dataset.mode===MODE));
    render();
  }
  btnRand.onclick=randomize;

  // Appliquer tokens Ã  :root
  btnApply.onclick=()=>{
    const root=document.documentElement.style;
    root.setProperty('--acc',           hslToHex(H,S,L));
    root.setProperty('--acc-2',         hslToHex(rot(H,180),S,L));
    root.setProperty('--acc-tri-1',     hslToHex(rot(H,120),S,L));
    root.setProperty('--acc-tri-2',     hslToHex(rot(H,-120),S,L));
    root.setProperty('--acc-analog-1',  hslToHex(rot(H,15),S,L));
    root.setProperty('--acc-analog-2',  hslToHex(rot(H,-15),S,L));
  };

  // Wizard nav (snap + boutons)
  function goto(i){
    step = clamp(i,0,3);
    const y = step * window.innerHeight; // approx
    screens.scrollTo({ top: y, behavior:'smooth' });
    dots.forEach((d,k)=> d.classList.toggle('on', k===step));
  }
  prev.onclick=()=> goto(step-1);
  next.onclick=()=> goto(step+1);
  screens.addEventListener('scroll', ()=>{
    const i = Math.round(screens.scrollTop / window.innerHeight);
    if(i!==step){ step=i; dots.forEach((d,k)=> d.classList.toggle('on', k===step)); }
  }, {passive:true});

  // Close + toggle (P)
  btnClose.onclick=()=> wrap.classList.add('pd-hidden');
  document.addEventListener('keydown', e=>{ if(e.key.toLowerCase()==='p'){ wrap.classList.toggle('pd-hidden') } });

  // Resize -> redraw wheel
  function onResize(){ dpr=Math.min(window.devicePixelRatio||1,2); drawWheel(); render(); }
  window.addEventListener('resize', onResize, {passive:true});

  // Init
  onResize();
})();
</script>
<!-- ========== /WIZARD MOBILE ========== -->
