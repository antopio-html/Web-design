<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PRISM — Roue & Palette plein écran</title>
<style>
  :root{
    --bg:#0b0f16; --ink:#f2f6ff; --muted:#9fb0d3; --ring:rgba(255,255,255,.16);
    --card:rgba(255,255,255,.06);
    --acc:#2bd9ff; --acc-2:#ff3cac;
  }
  @media (prefers-color-scheme: light){
    :root{ --bg:#f7faff; --ink:#0e1116; --muted:#4e5a73; --ring:rgba(0,0,0,.14); --card:rgba(0,0,0,.06) }
  }

  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);
    font: clamp(18px,4.8vw,20px)/1.6 Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; overflow-x:hidden}
  *{box-sizing:border-box}

  /* Décor futuriste léger */
  .stage{position:fixed; inset:-20% -10% -20% -10%; z-index:-1; pointer-events:none; filter:saturate(120%)}
  .mesh{position:absolute; inset:0;
    background:
      radial-gradient(60vmax 38vmax at 14% 16%, rgba(255,60,172,.25), transparent 60%),
      radial-gradient(60vmax 38vmax at 84% 18%, rgba(43,217,255,.25), transparent 60%),
      radial-gradient(60vmax 38vmax at 70% 80%, rgba(143,0,255,.18), transparent 60%);
    mix-blend-mode:screen; animation: float 28s ease-in-out infinite alternate}
  .beams::before,.beams::after{content:""; position:absolute; inset:-10% -20%; mix-blend-mode:screen; opacity:.55; filter:blur(8px);
    background:
      linear-gradient(70deg, transparent 40%, color-mix(in oklab, var(--acc) 40%, transparent) 50%, transparent 60%),
      linear-gradient(110deg, transparent 42%, color-mix(in oklab, var(--acc-2) 40%, transparent) 52%, transparent 62%);
    animation: sweep 18s cubic-bezier(.2,.8,.2,1) infinite}
  .beams::after{animation-direction:reverse; opacity:.45}
  @keyframes float{to{transform:translateY(-2%) scale(1.02)}} @keyframes sweep{from{transform:translateX(-6%) rotate(-1.5deg)} to{transform:translateX(6%) rotate(1.5deg)}}

  header{
    position:sticky; top:0; z-index:5; display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding: clamp(14px,5vw,22px); border-bottom:1px solid var(--ring);
    background: color-mix(in oklab, var(--card) 80%, transparent); backdrop-filter: blur(10px) saturate(140%);
  }
  .brand{font-weight:900; letter-spacing:.3px; display:flex; align-items:center; gap:.6em}
  .brand .dot{width:12px;height:12px;border-radius:50%;background:linear-gradient(180deg,var(--acc),var(--acc-2));box-shadow:0 0 14px var(--acc)}

  .btn{appearance:none; border:1px solid var(--ring); background:linear-gradient(180deg,rgba(255,255,255,.14),rgba(255,255,255,.06));
    color:inherit; border-radius:16px; padding:14px 18px; font-weight:900; min-height:48px}
  .btn.primary{background:linear-gradient(180deg,color-mix(in oklab,var(--acc) 28%, transparent), transparent);
    box-shadow:0 10px 30px color-mix(in oklab,var(--acc) 24%, transparent)}

  main{padding: clamp(16px,5.5vw,28px); display:grid; gap: clamp(14px,3.5vw,18px); max-width:1100px; margin:auto}
  .card{background:var(--card); border:1px solid var(--ring); border-radius:18px;
    padding: clamp(14px,4.5vw,18px); display:grid; gap: clamp(12px,3.5vw,16px)}
  h1{font-size: clamp(24px,7vw,34px); margin:0; font-weight:900}
  h2{font-size: clamp(20px,6vw,24px); margin:0; font-weight:900}
  .sub{color:var(--muted)}

  /* ROUE — contrôle principal */
  .wheel-wrap{ display:grid; gap:16px; place-items:center }
  .wheel{
    width: min(92vw, 560px); aspect-ratio:1/1; border-radius:50%;
    border:1px solid var(--ring);
    background:radial-gradient(circle, rgba(255,255,255,.06), transparent 62%);
    position:relative; touch-action:none;
  }
  .wheel canvas{ width:100%; height:100%; display:block }
  .knob{
    position:absolute; width:28px; height:28px; border-radius:50%; background:#fff; border:2px solid #111;
    transform:translate(-50%,-50%); box-shadow:0 0 0 6px rgba(0,0,0,.18); pointer-events:none
  }
  .sliders{ width:100%; max-width:560px; display:grid; gap:14px }
  .sliders label{ color:var(--muted) }
  input[type="range"]{ width:100%; height:52px; appearance:none; background:transparent }
  input[type="range"]::-webkit-slider-runnable-track{ height:12px; border-radius:999px; background:linear-gradient(90deg,var(--acc),var(--acc-2))}
  input[type="range"]::-webkit-slider-thumb{ appearance:none; width:34px;height:34px;border-radius:50%; background:#fff; border:2px solid #111; margin-top:-11px }
  input[type="range"]::-moz-range-track{ height:12px; border-radius:999px; background:linear-gradient(90deg,var(--acc),var(--acc-2))}
  input[type="range"]::-moz-range-thumb{ width:34px;height:34px;border-radius:50%; background:#fff; border:2px solid #111 }

  /* Harmonies + palette */
  .chips{display:flex; flex-wrap:wrap; gap:10px}
  .chip{padding:12px 16px; border-radius:14px; border:1px solid var(--ring); background:linear-gradient(180deg,rgba(255,255,255,.12),rgba(255,255,255,.05)); font-weight:800; min-height:44px}
  .chip.active{outline:2px solid color-mix(in oklab, var(--acc) 34%, transparent)}
  .sw-row{display:grid; grid-auto-flow:column; grid-auto-columns:minmax(200px,1fr); gap:12px; overflow-x:auto; padding-bottom:6px}
  .sw{border:1px solid var(--ring); border-radius:16px; overflow:hidden; background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02))}
  .sw .box{height:130px}
  .sw .meta{padding:12px; display:grid; gap:8px}
  .meta .top{display:flex; align-items:center; justify-content:space-between; gap:10px}
  .copy{padding:10px 12px; border-radius:12px; border:1px solid var(--ring); background:transparent; min-height:44px; font-weight:800}

  .actions{display:flex; flex-wrap:wrap; gap:10px}

  /* Aperçu & export */
  .preview{display:grid; gap:12px}
  .pane{border:1px solid var(--ring); border-radius:16px; overflow:hidden}
  .pane header{display:flex; justify-content:space-between; gap:10px; padding:12px 14px; color:var(--muted); border-bottom:1px solid var(--ring); background:color-mix(in oklab,var(--card) 70%, transparent)}
  .pane .box{min-height:90px; padding:14px; font-weight:900; font-size: clamp(20px,5.5vw,24px)}
  .tokens{width:100%; min-height:150px; font:15px/1.5 ui-monospace,Menlo,Consolas,monospace; color:var(--ink); background:transparent; border:1px dashed var(--ring); border-radius:14px; padding:14px}

  /* ===== Overlay “Palette plein écran” ===== */
  .overlay{
    position:fixed; inset:0; z-index:9999; display:none;
    background: color-mix(in oklab, var(--bg) 80%, #0000);
    backdrop-filter: blur(10px) saturate(140%);
    color:var(--ink);
  }
  .overlay.show{ display:grid; grid-template-rows:auto 1fr }
  .ov-top{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding: clamp(14px,5vw,20px); border-bottom:1px solid var(--ring); background:color-mix(in oklab, var(--card) 80%, transparent) }
  .ov-title{ font-weight:900; font-size: clamp(22px,6vw,28px) }
  .ov-grid{
    padding: clamp(14px,5vw,22px);
    display:grid; grid-template-columns: repeat(2, 1fr); gap:12px; align-content:start; overflow:auto;
  }
  @media (min-width: 720px){ .ov-grid{ grid-template-columns: repeat(3, 1fr) } }
  @media (min-width: 1040px){ .ov-grid{ grid-template-columns: repeat(5, 1fr) } }
  .ov-tile{
    border:1px solid var(--ring); border-radius:18px; overflow:hidden; background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));
    display:grid; grid-template-rows: min(28vh, 300px) auto;
  }
  .ov-tile .c{ width:100%; height:100% }
  .ov-meta{ padding:14px; display:grid; gap:6px }
  .ov-row{ display:flex; justify-content:space-between; gap:10px; align-items:center }
  .ov-copy{ padding:12px 14px; border-radius:12px; border:1px solid var(--ring); background:transparent; font-weight:900; min-height:44px }

  @media (prefers-reduced-motion: reduce){ .mesh,.beams::before,.beams::after{ animation:none !important } }
</style>
</head>
<body>
  <!-- Fond -->
  <div class="stage" aria-hidden="true"><div class="mesh"></div><div class="beams"></div></div>

  <header>
    <div class="brand"><span class="dot"></span> PRISM — Roue & Palette</div>
    <div class="actions">
      <button class="btn" id="random">Aléatoire</button>
      <button class="btn" id="expand">Palette plein écran</button>
      <button class="btn primary" id="apply">Appliquer au site</button>
    </div>
  </header>

  <main>
    <!-- ROUE (contrôle principal) -->
    <section class="card">
      <h1>Choisis ta teinte principale</h1>
      <p class="sub">Tourne la roue (au doigt). Ajuste saturation / luminosité — lisible sur smartphone.</p>
      <div class="wheel-wrap">
        <div class="wheel" id="wheelWrap">
          <canvas id="wheel"></canvas>
          <div class="knob" id="knob"></div>
        </div>
        <div class="sliders">
          <label for="sat">Saturation</label>
          <input id="sat" type="range" min="0" max="100" value="85" />
          <label for="lig">Luminosité</label>
          <input id="lig" type="range" min="0" max="100" value="55" />
        </div>
      </div>
    </section>

    <!-- Harmonies & palette (aperçu scrollable) -->
    <section class="card">
      <h2>Harmonies & palette</h2>
      <div class="chips" id="modes">
        <button class="chip" data-mode="complement">Complémentaire</button>
        <button class="chip" data-mode="triad">Triade</button>
        <button class="chip" data-mode="tetrad">Tétrade</button>
        <button class="chip" data-mode="analog">Analogues</button>
        <button class="chip" data-mode="mono">Monochrome</button>
      </div>
      <div class="sw-row" id="swRow"></div>
      <div class="actions"><button class="btn" id="fullPalette">Voir en grand</button></div>
    </section>

    <!-- Contraste & export -->
    <section class="card">
      <h2>Contraste & Export</h2>
      <div class="preview">
        <div class="pane">
          <header><span>Fond clair</span><span id="wcagLight">—</span></header>
          <div class="box" id="demoLight" style="background:#ffffff; color:#111">Aa — Titre & Bouton</div>
        </div>
        <div class="pane">
          <header><span>Fond sombre</span><span id="wcagDark">—</span></header>
          <div class="box" id="demoDark" style="background:#0b0f16; color:#f2f6ff">Aa — Titre & Bouton</div>
        </div>
      </div>
      <textarea class="tokens" id="tokens" readonly></textarea>
      <div class="actions">
        <button class="btn" id="copyCss">Copier CSS</button>
        <button class="btn" id="copyJson">Copier JSON</button>
      </div>
    </section>
  </main>

  <!-- Overlay palette plein écran -->
  <aside class="overlay" id="overlay" aria-label="Palette plein écran">
    <div class="ov-top">
      <div class="ov-title">Palette — plein écran</div>
      <div class="actions">
        <button class="btn" id="closeOv">Fermer</button>
      </div>
    </div>
    <div class="ov-grid" id="ovGrid"></div>
  </aside>

<script>
/* ==== util couleurs ==== */
const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
const rgbToHex=(r,g,b)=>'#'+[r,g,b].map(x=>x.toString(16).padStart(2,'0')).join('');
const hslToRgb=(h,s,l)=>{ s/=100; l/=100; const k=n=>(n+(h/30))%12; const a=s*Math.min(l,1-l);
  const f=n=> l - a*Math.max(-1, Math.min(k(n)-3, Math.min(9-k(n),1)));
  return [Math.round(255*f(0)),Math.round(255*f(8)),Math.round(255*f(4))] };
const hslToHex=(h,s,l)=>rgbToHex(...hslToRgb(h,s,l));
const hexToRgb=(hex)=>{ const m=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex); return m?[parseInt(m[1],16),parseInt(m[2],16),parseInt(m[3],16)]:[0,0,0] };
const luminance=(r,g,b)=>{ const t=[r,g,b].map(v=>{v/=255; return v<=.03928?v/12.92:Math.pow((v+0.055)/1.055,2.4)}); return 0.2126*t[0]+0.7152*t[1]+0.0722*t[2] };
const contrastRatio=(hex1,hex2)=>{ const [r1,g1,b1]=hexToRgb(hex1),[r2,g2,b2]=hexToRgb(hex2);
  const L1=luminance(r1,g1,b1)+0.05, L2=luminance(r2,g2,b2)+0.05; const ratio=L1>L2?L1/L2:L2/L1; return Math.round(ratio*100)/100 };
const wcag=(r)=> r>=7?'AAA': r>=4.5?'AA': r>=3?'AA (large)':'fail';
const rot=(h,d)=>(((h+d)%360)+360)%360;

/* ==== DOM ==== */
const wheelWrap = document.getElementById('wheelWrap');
const wheel = document.getElementById('wheel');
const knob = document.getElementById('knob');
const sat = document.getElementById('sat');
const lig = document.getElementById('lig');
const modes = document.getElementById('modes');
const swRow = document.getElementById('swRow');

const demoL = document.getElementById('demoLight');
const demoD = document.getElementById('demoDark');
const wcagL = document.getElementById('wcagLight');
const wcagD = document.getElementById('wcagDark');
const tokens = document.getElementById('tokens');
const copyCss = document.getElementById('copyCss');
const copyJson = document.getElementById('copyJson');

const randomBtn = document.getElementById('random');
const applyBtn = document.getElementById('apply');
const expandBtn = document.getElementById('expand');
const fullBtn = document.getElementById('fullPalette');

const overlay = document.getElementById('overlay');
const ovGrid = document.getElementById('ovGrid');
const closeOv = document.getElementById('closeOv');

/* ==== état ==== */
let H=190, S=85, L=55, MODE='complement';
let dpr = Math.min(window.devicePixelRatio||1, 2);

/* ==== ROUE (contrôle principal) ==== */
function drawWheel(){
  const size = Math.floor(wheelWrap.clientWidth * dpr);
  if(size<=0) return;
  wheel.width=size; wheel.height=size;
  const ctx = wheel.getContext('2d', { willReadFrequently:false });
  const r=size/2, cx=r, cy=r;
  ctx.clearRect(0,0,size,size);
  for(let deg=0;deg<360;deg++){
    const g=ctx.createRadialGradient(cx,cy, r*0.18, cx,cy, r*0.98);
    g.addColorStop(0, hslToHex(deg,20,50));
    g.addColorStop(1, hslToHex(deg,100,50));
    ctx.strokeStyle=g; ctx.beginPath();
    const a1=(deg-1)*Math.PI/180, a2=deg*Math.PI/180;
    ctx.arc(cx,cy,r-3,a1,a2); ctx.lineWidth=Math.max(18*dpr, 16); ctx.stroke();
  }
  ctx.beginPath(); ctx.arc(cx,cy,r*0.2,0,Math.PI*2);
  ctx.fillStyle='rgba(255,255,255,.08)'; ctx.fill();
  positionKnob();
}
function positionKnob(){
  const rect = wheelWrap.getBoundingClientRect();
  const r = rect.width/2;
  const ang = (H-90)*Math.PI/180;
  knob.style.left = (rect.width/2 + (r-20)*Math.cos(ang))+'px';
  knob.style.top  = (rect.height/2 + (r-20)*Math.sin(ang))+'px';
}
function hueFromPointer(x,y){
  const rect = wheelWrap.getBoundingClientRect();
  const dx = x - rect.left - rect.width/2;
  const dy = y - rect.top  - rect.height/2;
  H = (Math.round(Math.atan2(dy,dx)*180/Math.PI + 90) + 360) % 360;
  render();
}
let dragging=false;
wheelWrap.addEventListener('pointerdown', e=>{ dragging=true; wheelWrap.setPointerCapture(e.pointerId); hueFromPointer(e.clientX,e.clientY) });
wheelWrap.addEventListener('pointermove', e=>{ if(dragging) hueFromPointer(e.clientX,e.clientY) });
wheelWrap.addEventListener('pointerup',   e=>{ dragging=false; try{wheelWrap.releasePointerCapture(e.pointerId)}catch{} });

sat.addEventListener('input', e=>{ S=+e.target.value; render() });
lig.addEventListener('input', e=>{ L=+e.target.value; render() });

/* ==== harmonies ==== */
modes.querySelectorAll('.chip').forEach(b=>{
  if(b.dataset.mode===MODE) b.classList.add('active');
  b.addEventListener('click',()=>{
    modes.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
    b.classList.add('active'); MODE=b.dataset.mode; render();
  });
});

/* ==== build palette ==== */
function buildSet(){
  let set=[];
  if(MODE==='complement'){ set=[[H,S,L],[rot(H,180),S,L]]; }
  else if(MODE==='triad'){ set=[[H,S,L],[rot(H,120),S,L],[rot(H,-120),S,L]]; }
  else if(MODE==='tetrad'){ set=[[H,S,L],[rot(H,90),S,L],[rot(H,180),S,L],[rot(H,270),S,L]]; }
  else if(MODE==='analog'){ set=[[rot(H,-30),S,L],[H,S,L],[rot(H,15),S,L],[rot(H,30),S,L]]; }
  else if(MODE==='mono'){ set=[[H,S,clamp(L-20,0,100)],[H,S,L],[H,S,clamp(L+18,0,100)]]; }
  while(set.length<8){ set.push([H,S,clamp(L+(set.length-3)*8,0,100)]) } // étoffe pour le plein écran
  return set.slice(0,8);
}

/* ==== rendu UI (aperçu + export) ==== */
function render(){
  positionKnob();

  // mini-aperçu défilable
  swRow.innerHTML='';
  const set = buildSet();
  set.forEach(([h,s,l],i)=>{
    const hex=hslToHex(h,s,l);
    const sw=document.createElement('div');
    sw.className='sw';
    sw.innerHTML=`<div class="box" style="background:${hex}"></div>
      <div class="meta">
        <div class="top"><b>${i===0?'base':'var'+i}</b><button class="copy" data-copy="${hex}">Copier</button></div>
        <div class="sub">${hex.toUpperCase()} • hsl(${h}, ${s}%, ${l}%)</div>
      </div>`;
    swRow.appendChild(sw);
  });
  swRow.querySelectorAll('[data-copy]').forEach(b=>{
    b.onclick=()=> navigator.clipboard.writeText(b.dataset.copy);
    b.onpointerdown=(e)=>{ let t=setTimeout(()=>b.click(), 450); ['pointerup','pointercancel','pointerleave'].forEach(ev=>b.addEventListener(ev,()=>clearTimeout(t),{once:true})) };
  });

  // contraste
  const primary = hslToHex(H,S,L);
  demoL.style.color=primary; demoD.style.color=primary;
  wcagL.textContent='Contraste: '+wcag(contrastRatio(primary,'#ffffff'));
  wcagD.textContent='Contraste: '+wcag(contrastRatio(primary,'#0b0f16'));

  // export CSS
  const css = `:root{
  --acc: ${primary};
  --acc-2: ${hslToHex(rot(H,180),S,L)};
  --acc-tri-1: ${hslToHex(rot(H,120),S,L)};
  --acc-tri-2: ${hslToHex(rot(H,-120),S,L)};
  --acc-analog-1: ${hslToHex(rot(H,15),S,L)};
  --acc-analog-2: ${hslToHex(rot(H,-15),S,L)};
}`;
  tokens.value=css;

  // remplir overlay (plein écran)
  renderOverlay(set);
}

function renderOverlay(set){
  ovGrid.innerHTML='';
  set.forEach(([h,s,l],i)=>{
    const hex=hslToHex(h,s,l);
    const tile=document.createElement('div');
    tile.className='ov-tile';
    tile.innerHTML=`<div class="c" style="background:${hex}"></div>
      <div class="ov-meta">
        <div class="ov-row"><b style="font-weight:900">${i===0?'base':'var'+i}</b><button class="ov-copy" data-copy="${hex}">Copier</button></div>
        <div class="sub" style="color:var(--muted)">${hex.toUpperCase()} • hsl(${h}, ${s}%, ${l}%)</div>
      </div>`;
    ovGrid.appendChild(tile);
  });
  ovGrid.querySelectorAll('[data-copy]').forEach(b=>{
    b.onclick=()=> navigator.clipboard.writeText(b.dataset.copy);
  });
}

/* ==== actions ==== */
const curated=[
  ['Vaporwave',[315,80,65],'triad'],
  ['Tropical', [170,75,50],'analog'],
  ['Arcade',   [200,90,55],'tetrad'],
  ['Sunset',   [18,85,58], 'complement'],
  ['Aurora',   [155,70,54],'analog'],
  ['Sakura',   [340,70,66],'mono'],
  ['Cyber',    [190,90,55],'tetrad'],
];
randomBtn.addEventListener('click', ()=>{
  if(Math.random()<0.6){
    const [_,[h,s,l],m]=curated[Math.floor(Math.random()*curated.length)];
    [H,S,L]=[h,s,l]; MODE=m;
  }else{
    H=Math.floor(Math.random()*360);
    S=[65,70,75,80,85][Math.floor(Math.random()*5)];
    L=[48,52,56,60,64][Math.floor(Math.random()*5)];
    MODE=['complement','triad','tetrad','analog','mono'][Math.floor(Math.random()*5)];
  }
  modes.querySelectorAll('.chip').forEach(x=>x.classList.toggle('active', x.dataset.mode===MODE));
  render();
});
applyBtn.addEventListener('click', ()=>{
  const root=document.documentElement.style;
  root.setProperty('--acc',           hslToHex(H,S,L));
  root.setProperty('--acc-2',         hslToHex(rot(H,180),S,L));
});

expandBtn.addEventListener('click', ()=> overlay.classList.add('show'));
fullBtn.addEventListener('click',    ()=> overlay.classList.add('show'));
closeOv.addEventListener('click',    ()=> overlay.classList.remove('show'));

copyCss.onclick=()=> navigator.clipboard.writeText(tokens.value);
copyJson.onclick=()=>{
  const obj = {
    acc: hslToHex(H,S,L),
    acc2: hslToHex(rot(H,180),S,L),
    tri1: hslToHex(rot(H,120),S,L),
    tri2: hslToHex(rot(H,-120),S,L),
    analog1: hslToHex(rot(H,15),S,L),
    analog2: hslToHex(rot(H,-15),S,L)
  };
  navigator.clipboard.writeText(JSON.stringify(obj,null,2));
};

/* ==== init & resize ==== */
function onResize(){ dpr=Math.min(window.devicePixelRatio||1,2); drawWheel(); render(); }
window.addEventListener('resize', onResize, {passive:true});
onResize();
</script>
</body>
</html>
