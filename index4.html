<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PRISM — Générateur de palettes</title>
<style>
  :root{
    /* Thème (évolue quand on “Applique”) */
    --bg:#0b0f16; --ink:#f2f6ff; --muted:#9fb0d3; --ring:rgba(255,255,255,.16);
    --card:rgba(255,255,255,.06);
    --acc:#2bd9ff; --acc-2:#ff3cac; /* utilisés pour l’habillage */
  }
  @media (prefers-color-scheme: light){
    :root{ --bg:#f7faff; --ink:#0e1116; --muted:#4e5a73; --ring:rgba(0,0,0,.14); --card:rgba(0,0,0,.06) }
  }

  /* Base */
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);
    font: clamp(18px,4.8vw,20px)/1.6 Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; overflow-x:hidden}
  *{box-sizing:border-box}

  /* Fond futuriste safe-perf (mesh + faisceaux) */
  .stage{position:fixed; inset:-20% -10% -20% -10%; z-index:-1; pointer-events:none; filter:saturate(120%) blur(0.2px)}
  .mesh{
    position:absolute; inset:0;
    background:
      radial-gradient(60vmax 35vmax at 15% 15%, rgba(255,60,172,.25), transparent 60%),
      radial-gradient(60vmax 35vmax at 85% 20%, rgba(43,217,255,.25), transparent 60%),
      radial-gradient(60vmax 35vmax at 70% 80%, rgba(143,0,255,.18), transparent 60%);
    mix-blend-mode:screen; animation: float 28s ease-in-out infinite alternate;
  }
  .beams::before,.beams::after{
    content:""; position:absolute; inset:-10% -20%; mix-blend-mode:screen; opacity:.6; filter:blur(8px);
    background:
      linear-gradient(70deg, transparent 40%, color-mix(in oklab, var(--acc) 40%, transparent) 50%, transparent 60%),
      linear-gradient(110deg, transparent 42%, color-mix(in oklab, var(--acc-2) 40%, transparent) 52%, transparent 62%);
    animation: sweep 18s cubic-bezier(.2,.8,.2,1) infinite;
  }
  .beams::after{ animation-direction:reverse; opacity:.5 }
  @keyframes float{to{transform:translateY(-2%) scale(1.02)}}
  @keyframes sweep{from{transform:translateX(-6%) rotate(-1.5deg)} to{transform:translateX(6%) rotate(1.5deg)}}

  /* Layout */
  header{
    position:sticky; top:0; z-index:5;
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding: clamp(14px,5vw,22px);
    border-bottom:1px solid var(--ring);
    background: color-mix(in oklab, var(--card) 80%, transparent);
    backdrop-filter: blur(10px) saturate(140%);
  }
  .brand{font-weight:900; letter-spacing:.3px; display:flex; align-items:center; gap:.6em}
  .brand .dot{width:12px;height:12px;border-radius:50%;background:linear-gradient(180deg,var(--acc),var(--acc-2));box-shadow:0 0 14px var(--acc)}
  main{padding: clamp(16px,5.5vw,28px); display:grid; gap: clamp(14px,3.5vw,18px); max-width:1100px; margin:auto}
  .card{background:var(--card); border:1px solid var(--ring); border-radius:18px; padding: clamp(14px,4.5vw,18px); display:grid; gap: clamp(12px,3.5vw,16px)}
  h1{font-size: clamp(24px,7vw,34px); margin:0; font-weight:900}
  h2{font-size: clamp(20px,6vw,24px); margin:0; font-weight:900}
  .sub{color:var(--muted)}

  /* Contrôles (gros, touch-friendly) */
  .controls{display:grid; gap:14px}
  .row{display:grid; gap:10px}
  label{color:var(--muted)}
  input[type="color"]{
    appearance:none; width:100%; height:64px; border-radius:14px; border:1px solid var(--ring); background:transparent; padding:0
  }
  input[type="range"]{ width:100%; height:52px; appearance:none; background:transparent }
  input[type="range"]::-webkit-slider-runnable-track{ height:12px; border-radius:999px; background:linear-gradient(90deg,var(--acc),var(--acc-2))}
  input[type="range"]::-webkit-slider-thumb{ appearance:none; width:34px;height:34px;border-radius:50%; background:#fff; border:2px solid #111; margin-top:-11px }
  input[type="range"]::-moz-range-track{ height:12px; border-radius:999px; background:linear-gradient(90deg,var(--acc),var(--acc-2))}
  input[type="range"]::-moz-range-thumb{ width:34px;height:34px;border-radius:50%; background:#fff; border:2px solid #111 }

  .chips{display:flex; flex-wrap:wrap; gap:10px}
  .chip{padding:12px 16px; border-radius:14px; border:1px solid var(--ring); background:linear-gradient(180deg,rgba(255,255,255,.12),rgba(255,255,255,.05)); font-weight:800; min-height:44px}
  .chip.active{outline:2px solid color-mix(in oklab, var(--acc) 34%, transparent)}

  /* Swatches (scroll horizontal sur mobile) */
  .swatches{display:grid; gap:10px}
  .sw-row{display:grid; grid-auto-flow:column; grid-auto-columns: minmax(160px, 1fr); gap:10px; overflow-x:auto; padding-bottom:6px; scroll-snap-type:x proximity}
  .sw{border:1px solid var(--ring); border-radius:16px; overflow:hidden; background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02)); scroll-snap-align:center}
  .sw .box{height:110px}
  .sw .meta{padding:12px; display:grid; gap:8px}
  .meta .top{display:flex; align-items:center; justify-content:space-between; gap:10px}
  .copy{padding:10px 12px; border-radius:12px; border:1px solid var(--ring); background:transparent; min-height:44px; font-weight:800}

  /* Aperçu & export */
  .preview{display:grid; gap:12px}
  .pane{border:1px solid var(--ring); border-radius:16px; overflow:hidden}
  .pane header{display:flex; justify-content:space-between; gap:10px; padding:12px 14px; color:var(--muted); border-bottom:1px solid var(--ring); background:color-mix(in oklab,var(--card) 70%, transparent)}
  .pane .box{min-height:90px; padding:14px; font-weight:900; font-size: clamp(20px,5.5vw,24px)}
  .tokens{width:100%; min-height:150px; font:15px/1.5 ui-monospace,Menlo,Consolas,monospace; color:var(--ink); background:transparent; border:1px dashed var(--ring); border-radius:14px; padding:14px}

  /* Boutons */
  .actions{display:flex; flex-wrap:wrap; gap:10px}
  .btn{appearance:none; border:1px solid var(--ring); background:linear-gradient(180deg,rgba(255,255,255,.14),rgba(255,255,255,.06)); color:inherit; border-radius:16px; padding:14px 18px; font-weight:900; min-height:48px}
  .btn.primary{background:linear-gradient(180deg,color-mix(in oklab,var(--acc) 28%, transparent), transparent); box-shadow:0 10px 30px color-mix(in oklab,var(--acc) 24%, transparent)}

  /* A11y */
  @media (prefers-reduced-motion: reduce){
    .mesh,.beams::before,.beams::after{animation:none !important}
  }
</style>
</head>
<body>
  <!-- Fond -->
  <div class="stage" aria-hidden="true">
    <div class="mesh"></div>
    <div class="beams"></div>
  </div>

  <header>
    <div class="brand"><span class="dot"></span> PRISM — Générateur de palettes</div>
    <div class="actions">
      <button class="btn" id="random">Aléatoire</button>
      <button class="btn primary" id="apply">Appliquer au site</button>
    </div>
  </header>

  <main>
    <!-- 1. Point de départ -->
    <section class="card">
      <h1>Crée une palette lisible & futuriste</h1>
      <p class="sub">Choisis une teinte, ajuste saturation/luminosité, puis explore les harmonies. Tout est pensé <em>mobile-first</em>.</p>
      <div class="controls">
        <div class="row">
          <label for="baseColor">Teinte de base</label>
          <input id="baseColor" type="color" value="#2bd9ff" />
        </div>
        <div class="row">
          <label for="sat">Saturation</label>
          <input id="sat" type="range" min="0" max="100" value="85" />
        </div>
        <div class="row">
          <label for="lig">Luminosité</label>
          <input id="lig" type="range" min="0" max="100" value="55" />
        </div>
      </div>
    </section>

    <!-- 2. Harmonies -->
    <section class="card">
      <h2>Harmonies</h2>
      <div class="chips" id="modes">
        <button class="chip" data-mode="complement">Complémentaire</button>
        <button class="chip" data-mode="triad">Triade</button>
        <button class="chip" data-mode="tetrad">Tétrade</button>
        <button class="chip" data-mode="analog">Analogues</button>
        <button class="chip" data-mode="mono">Monochrome</button>
      </div>
      <div class="swatches">
        <div class="sw-row" id="swRow"><!-- rempli par JS --></div>
      </div>
    </section>

    <!-- 3. Contraste & Export -->
    <section class="card">
      <h2>Contraste & export</h2>
      <div class="preview">
        <div class="pane">
          <header><span>Fond clair</span><span id="wcagLight">—</span></header>
          <div class="box" id="demoLight" style="background:#ffffff; color:#111">Aa — Titre & Bouton</div>
        </div>
        <div class="pane">
          <header><span>Fond sombre</span><span id="wcagDark">—</span></header>
          <div class="box" id="demoDark" style="background:#0b0f16; color:#f2f6ff">Aa — Titre & Bouton</div>
        </div>
      </div>
      <textarea class="tokens" id="tokens" readonly></textarea>
      <div class="actions">
        <button class="btn" id="copyCss">Copier CSS</button>
        <button class="btn" id="copyJson">Copier JSON</button>
      </div>
    </section>
  </main>

<script>
/* ==== Utilitaires couleur ==== */
const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
const hexToRgb=(hex)=>{
  const m=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return m ? [parseInt(m[1],16),parseInt(m[2],16),parseInt(m[3],16)] : [0,0,0];
};
const rgbToHex=(r,g,b)=>'#'+[r,g,b].map(x=>x.toString(16).padStart(2,'0')).join('');
const hslToRgb=(h,s,l)=>{ s/=100; l/=100; const k=n=>(n+(h/30))%12; const a=s*Math.min(l,1-l);
  const f=n=> l - a*Math.max(-1, Math.min(k(n)-3, Math.min(9-k(n),1)));
  return [Math.round(255*f(0)),Math.round(255*f(8)),Math.round(255*f(4))];
};
const rgbToHsl=(r,g,b)=>{
  r/=255; g/=255; b/=255;
  const max=Math.max(r,g,b), min=Math.min(r,g,b);
  let h,s,l=(max+min)/2;
  if(max===min){ h=s=0 } else{
    const d=max-min; s = l>0.5 ? d/(2-max-min) : d/(max+min);
    switch(max){ case r: h=(g-b)/d + (g<b?6:0); break; case g: h=(b-r)/d+2; break; default: h=(r-g)/d+4 }
    h*=60;
  }
  return [Math.round(h), Math.round(s*100), Math.round(l*100)];
};
const hslToHex=(h,s,l)=> rgbToHex(...hslToRgb(h,s,l));
const luminance=(r,g,b)=>{ const t=[r,g,b].map(v=>{v/=255; return v<=.03928?v/12.92:Math.pow((v+0.055)/1.055,2.4)}); return 0.2126*t[0]+0.7152*t[1]+0.0722*t[2] };
const contrastRatio=(hex1,hex2)=>{ const [r1,g1,b1]=hexToRgb(hex1),[r2,g2,b2]=hexToRgb(hex2);
  const L1=luminance(r1,g1,b1)+0.05, L2=luminance(r2,g2,b2)+0.05; const ratio=L1>L2?L1/L2:L2/L1; return Math.round(ratio*100)/100 };
const wcag=(r)=> r>=7?'AAA': r>=4.5?'AA': r>=3?'AA (large)':'fail';
const rot=(h,d)=>(((h+d)%360)+360)%360;

/* ==== DOM ==== */
const baseColor = document.getElementById('baseColor');
const sat = document.getElementById('sat');
const lig = document.getElementById('lig');
const modes = document.getElementById('modes');
const swRow = document.getElementById('swRow');
const demoL = document.getElementById('demoLight');
const demoD = document.getElementById('demoDark');
const wcagL = document.getElementById('wcagLight');
const wcagD = document.getElementById('wcagDark');
const tokens = document.getElementById('tokens');
const copyCss = document.getElementById('copyCss');
const copyJson = document.getElementById('copyJson');
const randomBtn = document.getElementById('random');
const applyBtn = document.getElementById('apply');

/* ==== État ==== */
let MODE='complement';
let H=190, S=85, L=55; // init proche du cyan
updateFromHex(baseColor.value);

/* ==== Harmonies ==== */
modes.querySelectorAll('.chip').forEach(b=>{
  if(b.dataset.mode===MODE) b.classList.add('active');
  b.addEventListener('click',()=>{
    modes.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
    b.classList.add('active'); MODE=b.dataset.mode; render();
  });
});

/* ==== Interactions ==== */
baseColor.addEventListener('input', e=>{ updateFromHex(e.target.value); render(); });
sat.addEventListener('input', e=>{ S=+e.target.value; render(); });
lig.addEventListener('input', e=>{ L=+e.target.value; render(); });

randomBtn.addEventListener('click', ()=>{
  // 60% curaté, 40% algo
  const curated=[
    ['Vaporwave',[315,80,65],'triad'],
    ['Tropical',[170,75,50],'analog'],
    ['Arcade',[200,90,55],'tetrad'],
    ['Sunset',[18,85,58],'complement'],
    ['Aurora',[155,70,54],'analog'],
    ['Sakura',[340,70,66],'mono'],
    ['Cyber',[190,90,55],'tetrad']
  ];
  if(Math.random()<0.6){
    const [_,[h,s,l],m]=curated[Math.floor(Math.random()*curated.length)];
    [H,S,L]=[h,s,l]; MODE=m;
  }else{
    H=Math.floor(Math.random()*360);
    S=[65,70,75,80,85][Math.floor(Math.random()*5)];
    L=[48,52,56,60,64][Math.floor(Math.random()*5)];
    MODE=['complement','triad','tetrad','analog','mono'][Math.floor(Math.random()*5)];
  }
  modes.querySelectorAll('.chip').forEach(x=>x.classList.toggle('active', x.dataset.mode===MODE));
  baseColor.value = hslToHex(H,100,50); // indicatif
  sat.value=S; lig.value=L;
  render();
});

applyBtn.addEventListener('click', ()=>{
  const root = document.documentElement.style;
  const acc = hslToHex(H,S,L);
  root.setProperty('--acc', acc);
  root.setProperty('--acc-2', hslToHex(rot(H,180),S,L));
  // Facultatif : teinter l’habillage
  document.querySelector('.brand .dot').style.background = `linear-gradient(180deg, ${acc}, ${hslToHex(rot(H,180),S,L)})`;
});

/* ==== Core ==== */
function updateFromHex(hex){
  const [r,g,b]=hexToRgb(hex);
  [H] = rgbToHsl(r,g,b); // on se cale sur la teinte, S/L contrôlés par sliders
  sat.value=S; lig.value=L;
}

function buildSet(){
  let set=[];
  if(MODE==='complement'){
    set=[[H,S,L],[rot(H,180),S,L]];
  }else if(MODE==='triad'){
    set=[[H,S,L],[rot(H,120),S,L],[rot(H,-120),S,L]];
  }else if(MODE==='tetrad'){
    set=[[H,S,L],[rot(H,90),S,L],[rot(H,180),S,L],[rot(H,270),S,L]];
  }else if(MODE==='analog'){
    set=[[rot(H,-30),S,L],[H,S,L],[rot(H,15),S,L],[rot(H,30),S,L]];
  }else if(MODE==='mono'){
    set=[[H,S,clamp(L-20,0,100)],[H,S,L],[H,S,clamp(L+18,0,100)]];
  }
  while(set.length<5){ set.push([H,S,clamp(L+(set.length-2)*10,0,100)]) }
  return set.slice(0,5);
}

function render(){
  // Swatches
  swRow.innerHTML='';
  const set = buildSet();
  set.forEach(([h,s,l],i)=>{
    const hex = hslToHex(h,s,l);
    const sw = document.createElement('div');
    sw.className='sw';
    sw.innerHTML = `
      <div class="box" style="background:${hex}"></div>
      <div class="meta">
        <div class="top"><b>${i===0?'base':'var'+i}</b><button class="copy" data-copy="${hex}">Copier</button></div>
        <div class="sub">${hex.toUpperCase()} • hsl(${h}, ${s}%, ${l}%)</div>
      </div>`;
    swRow.appendChild(sw);
  });
  swRow.querySelectorAll('[data-copy]').forEach(b=>{
    b.onclick=()=> navigator.clipboard.writeText(b.dataset.copy);
    // appui long mobile
    b.onpointerdown=(e)=>{ let t=setTimeout(()=>b.click(), 450); ['pointerup','pointercancel','pointerleave'].forEach(ev=>b.addEventListener(ev,()=>clearTimeout(t),{once:true})) };
  });

  // Contraste
  const primary = hslToHex(H,S,L);
  demoL.style.color = primary;
  demoD.style.color = primary;
  wcagL.textContent = 'Contraste: ' + wcag(contrastRatio(primary, '#ffffff'));
  wcagD.textContent = 'Contraste: ' + wcag(contrastRatio(primary, '#0b0f16'));

  // Export
  const tokensCss = `:root{
  --acc: ${primary};
  --acc-2: ${hslToHex(rot(H,180),S,L)};
  --acc-tri-1: ${hslToHex(rot(H,120),S,L)};
  --acc-tri-2: ${hslToHex(rot(H,-120),S,L)};
  --acc-analog-1: ${hslToHex(rot(H,15),S,L)};
  --acc-analog-2: ${hslToHex(rot(H,-15),S,L)};
}`;
  tokens.value = tokensCss;

  copyCss.onclick = ()=> navigator.clipboard.writeText(tokensCss);
  copyJson.onclick = ()=>{
    const obj = {
      acc: primary,
      acc2: hslToHex(rot(H,180),S,L),
      tri1: hslToHex(rot(H,120),S,L),
      tri2: hslToHex(rot(H,-120),S,L),
      analog1: hslToHex(rot(H,15),S,L),
      analog2: hslToHex(rot(H,-15),S,L)
    };
    navigator.clipboard.writeText(JSON.stringify(obj,null,2));
  };
}

/* Init */
render();
</script>
</body>
</html>
