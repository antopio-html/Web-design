<!-- ============ ðŸŽ¨ PALETTE DESIGNER ============ -->
<style>
  :root {
    --pd-bg: rgba(10,11,16,.78);
    --pd-card: rgba(255,255,255,.06);
    --pd-ring: rgba(255,255,255,.12);
    --pd-ink: #e8ecff;
    --pd-muted:#a7b0d0;
  }
  @media (prefers-color-scheme: light){
    :root{ --pd-bg: rgba(250,252,255,.86); --pd-card: rgba(0,0,0,.06); --pd-ring: rgba(0,0,0,.12); --pd-ink:#0e1116; --pd-muted:#596274 }
  }

  .pd-fab{
    position:fixed; right:16px; bottom:16px; z-index:9999;
    background:linear-gradient(180deg,#fff,rgba(255,255,255,.85));
    border:1px solid var(--pd-ring); color:#111; border-radius:14px; padding:10px 14px; cursor:pointer;
    box-shadow:0 10px 30px rgba(0,0,0,.25); display:flex; gap:8px; align-items:center; user-select:none;
  }
  .pd-fab b{font-weight:700}
  .pd-fab:active{ transform:translateY(1px) }

  .pd-panel{
    position:fixed; inset:auto 16px 16px auto; width:min(420px, 94vw); z-index:10000;
    background:var(--pd-bg); color:var(--pd-ink);
    backdrop-filter: blur(12px) saturate(140%);
    border:1px solid var(--pd-ring); border-radius:18px; box-shadow:0 18px 60px rgba(0,0,0,.45);
    display:none; grid-template-rows:auto auto 1fr auto; overflow:hidden;
  }
  .pd-panel.show{ display:grid }
  .pd-hdr{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    padding:10px 12px; background:var(--pd-card); border-bottom:1px solid var(--pd-ring); cursor:move;
  }
  .pd-hdr .pd-title{display:flex; gap:10px; align-items:center}
  .pd-hdr .pd-actions{display:flex; gap:8px}
  .pd-btn{
    appearance:none; background:transparent; color:inherit; border:1px solid var(--pd-ring);
    padding:8px 10px; border-radius:10px; cursor:pointer;
  }

  .pd-body{ display:grid; grid-template-columns: 180px 1fr; gap:12px; padding:12px }
  @media (max-width:560px){ .pd-body{ grid-template-columns: 1fr } }

  .pd-wheel-wrap{ display:grid; gap:10px; align-content:start }
  .pd-canvas{
    width:180px; height:180px; border-radius:50%; border:1px solid var(--pd-ring);
    background:var(--pd-card); box-shadow:inset 0 0 0 1px rgba(255,255,255,.04);
    position:relative; overflow:hidden;
  }
  .pd-canvas canvas{ width:100%; height:100%; display:block }
  .pd-knob{
    position:absolute; width:14px; height:14px; border-radius:50%; background:#fff; border:2px solid #111;
    transform:translate(-50%,-50%); pointer-events:none; box-shadow:0 0 0 3px rgba(0,0,0,.15);
  }
  .pd-sl{
    display:grid; gap:8px;
  }
  .pd-sl label{ font-size:12px; color:var(--pd-muted) }
  .pd-sl input[type="range"]{ width:100% }

  .pd-swatches{ display:grid; gap:10px; align-content:start }
  .pd-modes{ display:flex; flex-wrap:wrap; gap:6px }
  .pd-chip{
    font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--pd-ring); background:var(--pd-card); cursor:pointer;
  }
  .pd-grid{
    display:grid; grid-template-columns:repeat(5, 1fr); gap:10px;
  }
  .pd-swatch{
    border:1px solid var(--pd-ring); border-radius:12px; overflow:hidden; background:var(--pd-card);
    display:grid; grid-template-rows: 56px auto;
  }
  .pd-swatch .box{ min-height:56px }
  .pd-swatch .meta{ padding:8px; display:grid; gap:4px }
  .pd-swatch small{ color:var(--pd-muted); font-size:11px }
  .pd-row{ display:flex; align-items:center; gap:8px; justify-content:space-between }

  .pd-contrast{ display:grid; gap:8px; padding:0 12px 12px 12px }
  .pd-preview{
    display:grid; grid-template-columns:1fr 1fr; gap:8px;
  }
  .pd-card{
    border:1px solid var(--pd-ring); border-radius:12px; overflow:hidden;
  }
  .pd-card .demo{
    padding:12px; min-height:62px; font-size:14px;
  }
  .pd-card header{
    display:flex; justify-content:space-between; padding:8px 10px; font-size:12px; color:var(--pd-muted); background:var(--pd-card);
    border-bottom:1px solid var(--pd-ring);
  }

  .pd-ft{
    border-top:1px solid var(--pd-ring); background:var(--pd-card); padding:10px; display:flex; gap:8px; flex-wrap:wrap; align-items:center
  }
  .pd-txt{ width:100%; min-height:84px; font:12px/1.4 ui-monospace,Menlo,Consolas,monospace; background:transparent; color:var(--pd-ink); border:1px dashed var(--pd-ring); border-radius:8px; padding:8px }
  .pd-copy{ margin-left:auto }

  .pd-toast{
    position:fixed; left:50%; bottom:18px; transform:translateX(-50%); background:#111a; color:#fff; padding:8px 12px; border-radius:10px; display:none;
  }
  .pd-toast.show{ display:block; animation: fadepd 1.6s ease both }
  @keyframes fadepd{ 0%{opacity:0; transform:translateX(-50%) translateY(6px)} 12%{opacity:1; transform:translateX(-50%) translateY(0)} 100%{opacity:0} }
</style>

<button class="pd-fab" id="pdOpen" aria-label="Ouvrir la palette">ðŸŽ¨ <b>Palette</b></button>

<aside class="pd-panel" id="pdPanel" role="dialog" aria-label="Concepteur de palettes">
  <div class="pd-hdr" id="pdDrag">
    <div class="pd-title">ðŸŽ¨ Roue & complÃ©ments</div>
    <div class="pd-actions">
      <button class="pd-btn" id="pdClose">Fermer</button>
    </div>
  </div>

  <div class="pd-body">
    <!-- Col. roue -->
    <div class="pd-wheel-wrap">
      <div class="pd-canvas" id="pdCanvas">
        <canvas id="pdWheel" width="180" height="180"></canvas>
        <div class="pd-knob" id="pdKnob" style="left:90px;top:10px"></div>
      </div>
      <div class="pd-sl">
        <label for="pdSat">Saturation</label>
        <input id="pdSat" type="range" min="0" max="100" value="80">
        <label for="pdLig">LuminositÃ©</label>
        <input id="pdLig" type="range" min="0" max="100" value="55">
      </div>
    </div>

    <!-- Col. swatches -->
    <div class="pd-swatches">
      <div class="pd-modes">
        <button class="pd-chip" data-mode="complement">ComplÃ©mentaire</button>
        <button class="pd-chip" data-mode="triad">Triade</button>
        <button class="pd-chip" data-mode="tetrad">TÃ©trade</button>
        <button class="pd-chip" data-mode="analog">Analogues</button>
        <button class="pd-chip" data-mode="mono">Monochrome</button>
      </div>
      <div class="pd-grid" id="pdGrid"></div>
    </div>
  </div>

  <div class="pd-contrast">
    <div class="pd-preview">
      <div class="pd-card">
        <header><span>Fond clair</span><span id="pdAA1">â€”</span></header>
        <div class="demo" id="pdDemoLight" style="background:#fff; color:#111">Aa â€” Titre & bouton</div>
      </div>
      <div class="pd-card">
        <header><span>Fond sombre</span><span id="pdAA2">â€”</span></header>
        <div class="demo" id="pdDemoDark" style="background:#0a0b10; color:#e8ecff">Aa â€” Titre & bouton</div>
      </div>
    </div>
  </div>

  <div class="pd-ft">
    <textarea class="pd-txt" id="pdTokens" readonly></textarea>
    <button class="pd-btn pd-copy" id="pdCopy">Copier tokens CSS</button>
  </div>
</aside>

<div class="pd-toast" id="pdToast">CopiÃ© âœ…</div>

<script>
(function(){
  /* ====== helpers couleurs ====== */
  const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
  const hslToRgb=(h,s,l)=>{
    s/=100; l/=100;
    const k=n=>(n+(h/30))%12;
    const a=s*Math.min(l,1-l);
    const f=n=> l - a*Math.max(-1, Math.min(k(n)-3, Math.min(9-k(n),1)));
    return [Math.round(255*f(0)), Math.round(255*f(8)), Math.round(255*f(4))];
  };
  const rgbToHex=(r,g,b)=>'#'+[r,g,b].map(x=>x.toString(16).padStart(2,'0')).join('');
  const hslToHex=(h,s,l)=>{ const [r,g,b]=hslToRgb(h,s,l); return rgbToHex(r,g,b) };
  const hexToRgb=(hex)=>{
    const m = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return m ? [parseInt(m[1],16), parseInt(m[2],16), parseInt(m[3],16)] : [0,0,0];
  };
  const luminance=(r,g,b)=>{
    const t = [r,g,b].map(v=>{v/=255; return v<=.03928? v/12.92 : Math.pow((v+0.055)/1.055,2.4)});
    return 0.2126*t[0]+0.7152*t[1]+0.0722*t[2];
  };
  const contrastRatio=(hex1, hex2)=>{
    const [r1,g1,b1]=hexToRgb(hex1), [r2,g2,b2]=hexToRgb(hex2);
    const L1=luminance(r1,g1,b1)+0.05, L2=luminance(r2,g2,b2)+0.05;
    const ratio=L1>L2?L1/L2:L2/L1; return Math.round(ratio*100)/100;
  };
  const wcag=(ratio)=> ratio>=7 ? 'AAA' : ratio>=4.5 ? 'AA' : ratio>=3 ? 'AA (large)' : 'fail';

  const wheel = document.getElementById('pdWheel');
  const ctx = wheel.getContext('2d', { willReadFrequently:false });
  const knob = document.getElementById('pdKnob');
  const sat = document.getElementById('pdSat');
  const lig = document.getElementById('pdLig');
  const grid = document.getElementById('pdGrid');
  const modes = document.querySelectorAll('.pd-chip');
  const tokens = document.getElementById('pdTokens');
  const demoL = document.getElementById('pdDemoLight');
  const demoD = document.getElementById('pdDemoDark');
  const a1 = document.getElementById('pdAA1');
  const a2 = document.getElementById('pdAA2');

  let H = 200, S = 80, L = 55, MODE = 'complement';

  /* ====== dessine la roue ====== */
  function drawWheel(){
    const r = wheel.width/2, cx=r, cy=r;
    for(let deg=0; deg<360; deg++){
      const grd = ctx.createRadialGradient(cx,cy, r*0.2, cx,cy,r);
      grd.addColorStop(0, hslToHex(deg, 20, 50));
      grd.addColorStop(1, hslToHex(deg, 100, 50));
      ctx.strokeStyle = grd;
      ctx.beginPath();
      const a1=(deg-1)*Math.PI/180, a2=deg*Math.PI/180;
      ctx.arc(cx,cy,r-1,a1,a2);
      ctx.lineWidth=10;
      ctx.stroke();
    }
    // centre
    ctx.beginPath();
    ctx.arc(cx,cy,r*0.2,0,Math.PI*2);
    ctx.fillStyle='rgba(255,255,255,.06)';
    ctx.fill();
  }

  /* ====== palettisation ====== */
  const rot=(h,delta)=> ( (h+delta)%360 + 360 ) % 360;
  function buildSet(){
    const base = { name:'base', h:H, s:S, l:L };
    let set = [];
    if(MODE==='complement'){
      set = [ base, {name:'comp', h:rot(H,180), s:S, l:L} ];
    } else if(MODE==='triad'){
      set = [ base, {name:'tri-1', h:rot(H,120), s:S, l:L}, {name:'tri-2', h:rot(H,-120), s:S, l:L} ];
    } else if(MODE==='tetrad'){
      set = [ base, {name:'tet-1', h:rot(H,90), s:S, l:L}, {name:'tet-2', h:rot(H,180), s:S, l:L}, {name:'tet-3', h:rot(H,270), s:S, l:L} ];
    } else if(MODE==='analog'){
      set = [ {name:'an-2', h:rot(H,-30), s:S, l:L}, base, {name:'an+1', h:rot(H,15), s:S, l:L}, {name:'an+2', h:rot(H,30), s:S, l:L} ];
    } else if(MODE==='mono'){
      set = [ {name:'m-1', h:H, s:clamp(S,0,100), l:clamp(L-20,0,100)},
              base,
              {name:'m+1', h:H, s:clamp(S,0,100), l:clamp(L+20,0,100)} ];
    }
    // normalise Ã  5 cases (complÃ¨te avec variations)
    while(set.length<5){
      set.push({ name:'v'+set.length, h:H, s:S, l: clamp(L + (set.length-2)*10, 0, 100) });
    }
    return set.slice(0,5);
  }

  /* ====== rendu swatches + actions ====== */
  function render(){
    sat.value=S; lig.value=L;
    const r = wheel.width/2, cx=r, cy=r, angle = (H-90)*Math.PI/180; // -90 pour dÃ©marrer en haut
    const kx = cx + (r-12)*Math.cos(angle), ky = cy + (r-12)*Math.sin(angle);
    knob.style.left = kx+'px'; knob.style.top = ky+'px';

    const set = buildSet();
    grid.innerHTML = '';
    set.forEach((c,i)=>{
      const hex = hslToHex(c.h, c.s, c.l);
      const sw = document.createElement('div');
      sw.className='pd-swatch';
      sw.innerHTML = `
        <div class="box" style="background:${hex}"></div>
        <div class="meta">
          <div class="pd-row"><b>${c.name}</b><button class="pd-btn" data-copy="${hex}">Copier</button></div>
          <small>${hex.toUpperCase()} â€¢ hsl(${c.h}, ${c.s}%, ${c.l}%)</small>
        </div>`;
      grid.appendChild(sw);
    });

    // contrastes
    const primary = hslToHex(H,S,L);
    demoL.style.color = primary;
    demoD.style.color = primary;
    a1.textContent = 'Contraste: ' + wcag(contrastRatio(primary, '#ffffff'));
    a2.textContent = 'Contraste: ' + wcag(contrastRatio(primary, '#0a0b10'));

    // tokens CSS
    const comp = hslToHex(rot(H,180), S, L);
    const tri1 = hslToHex(rot(H,120), S, L);
    const tri2 = hslToHex(rot(H,-120), S, L);
    const txt = `:root{
  --acc: ${primary};
  --acc-2: ${comp};
  --acc-tri-1: ${tri1};
  --acc-tri-2: ${tri2};
  --acc-analog-1: ${hslToHex(rot(H,15), S, L)};
  --acc-analog-2: ${hslToHex(rot(H,-15), S, L)};
}`;
    tokens.value = txt;

    // actions copier
    grid.querySelectorAll('[data-copy]').forEach(b=>{
      b.onclick=()=> copyText(b.getAttribute('data-copy'));
    });
  }

  /* ====== interactions roue ====== */
  function setHueFromPoint(clientX, clientY){
    const rect = wheel.getBoundingClientRect();
    const x = clientX - rect.left - rect.width/2;
    const y = clientY - rect.top - rect.height/2;
    const ang = Math.atan2(y, x) * 180/Math.PI + 90;
    H = (Math.round(ang)+360)%360;
    render();
  }
  let dragging=false;
  wheel.addEventListener('pointerdown', e=>{ dragging=true; setHueFromPoint(e.clientX,e.clientY); wheel.setPointerCapture(e.pointerId) });
  wheel.addEventListener('pointermove', e=>{ if(dragging) setHueFromPoint(e.clientX,e.clientY) });
  wheel.addEventListener('pointerup',   e=>{ dragging=false; try{wheel.releasePointerCapture(e.pointerId)}catch{} });

  sat.oninput = e=>{ S = +e.target.value; render() }
  lig.oninput = e=>{ L = +e.target.value; render() }

  modes.forEach(m=> m.addEventListener('click', ()=>{
    modes.forEach(x=> x.classList.remove('active'));
    m.classList.add('active');
    MODE = m.dataset.mode;
    render();
  }));

  /* ====== draw init & render ====== */
  function initWheel(){ drawWheel(); render(); }
  initWheel();

  /* ====== panneau (open/close + drag) ====== */
  const fab = document.getElementById('pdOpen');
  const panel = document.getElementById('pdPanel');
  const close = document.getElementById('pdClose');
  const drag = document.getElementById('pdDrag');
  fab.onclick = ()=> panel.classList.toggle('show');
  close.onclick = ()=> panel.classList.remove('show');

  // drag du panneau
  let ox=0, oy=0, draggingPanel=false, startLeft=0, startTop=0;
  drag.addEventListener('pointerdown', e=>{
    draggingPanel=true;
    const rect = panel.getBoundingClientRect();
    startLeft = rect.left; startTop = rect.top;
    ox = e.clientX; oy = e.clientY;
    drag.setPointerCapture(e.pointerId);
  });
  drag.addEventListener('pointermove', e=>{
    if(!draggingPanel) return;
    const dx = e.clientX - ox, dy = e.clientY - oy;
    panel.style.inset = 'auto auto auto auto';
    panel.style.left = (startLeft + dx) + 'px';
    panel.style.top  = (startTop + dy) + 'px';
  });
  drag.addEventListener('pointerup', e=>{ draggingPanel=false; try{drag.releasePointerCapture(e.pointerId)}catch{} });

  /* ====== copier tokens ====== */
  const toast = document.getElementById('pdToast');
  function copyText(t){
    navigator.clipboard.writeText(t).then(()=>{
      toast.classList.add('show'); setTimeout(()=> toast.classList.remove('show'), 1200);
    });
  }
  document.getElementById('pdCopy').onclick = ()=> copyText(tokens.value);

  /* ====== init chip active ====== */
  document.querySelector('.pd-chip[data-mode="'+MODE+'"]').classList.add('active');
})();
</script>
<!-- ========== /PALETTE DESIGNER ========== -->
