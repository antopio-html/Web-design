<!-- ============ ðŸŽ¨ PALETTE DESIGNER â€” FULLSCREEN ============ -->
<style>
  :root {
    --pd-bg: rgba(10,11,16,.88);
    --pd-card: rgba(255,255,255,.06);
    --pd-ring: rgba(255,255,255,.12);
    --pd-ink: #e8ecff; --pd-muted:#a7b0d0;
  }
  @media (prefers-color-scheme: light){
    :root{ --pd-bg: rgba(250,252,255,.94); --pd-card: rgba(0,0,0,.06); --pd-ring: rgba(0,0,0,.12); --pd-ink:#0e1116; --pd-muted:#596274 }
  }

  /* Overlay plein Ã©cran */
  .pd-overlay{
    position:fixed; inset:0; z-index:99999;
    background: var(--pd-bg);
    backdrop-filter: blur(12px) saturate(140%);
    color: var(--pd-ink);
    display:grid; grid-template-rows:auto 1fr auto;
  }
  .pd-hidden{ display:none }

  /* Topbar */
  .pd-top{
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding:12px clamp(12px, 4vw, 28px);
    border-bottom:1px solid var(--pd-ring); background: var(--pd-card);
  }
  .pd-title{ font-weight:800; letter-spacing:.2px; display:flex; gap:10px; align-items:center }
  .pd-actions{ display:flex; gap:8px; flex-wrap:wrap }
  .pd-btn{
    appearance:none; background:transparent; color:inherit; border:1px solid var(--pd-ring);
    padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600;
  }

  /* Corps en 3 colonnes (grandes surfaces) */
  .pd-body{
    display:grid; grid-template-columns: 360px 1fr 420px; gap:16px;
    padding:16px clamp(12px, 3vw, 28px);
    overflow:auto;
  }
  @media (max-width:1200px){ .pd-body{ grid-template-columns: 320px 1fr 360px } }
  @media (max-width:980px){  .pd-body{ grid-template-columns: 1fr; grid-auto-rows: min-content } }

  /* Col. 1 : roue + sliders */
  .pd-section{ display:grid; gap:14px; align-content:start }
  .pd-card{
    border:1px solid var(--pd-ring); border-radius:16px; background:var(--pd-card);
    padding:14px; overflow:hidden;
  }
  .pd-h3{ margin:0 0 8px; font-size:14px; color:var(--pd-muted) }

  .pd-canvas{
    --size: 320px;
    width:var(--size); height:var(--size); border-radius:50%; border:1px solid var(--pd-ring);
    background:var(--pd-card); margin:auto; position:relative;
  }
  @media (max-width:1200px){ .pd-canvas{ --size: 280px } }
  @media (max-width:600px){  .pd-canvas{ --size: 240px } }
  .pd-canvas canvas{ width:100%; height:100%; display:block }
  .pd-knob{
    position:absolute; width:18px; height:18px; border-radius:50%; background:#fff; border:2px solid #111;
    transform:translate(-50%,-50%); pointer-events:none; box-shadow:0 0 0 4px rgba(0,0,0,.15);
  }
  .pd-sl{ display:grid; gap:10px }
  .pd-sl label{ font-size:12px; color:var(--pd-muted) }
  .pd-sl input[type="range"]{ width:100% }

  /* Col. 2 : modes + swatches */
  .pd-modes{ display:flex; flex-wrap:wrap; gap:8px }
  .pd-chip{
    font-size:12px; padding:8px 12px; border-radius:999px; border:1px solid var(--pd-ring);
    background:var(--pd-card); cursor:pointer;
  }
  .pd-chip.active{ outline:2px solid rgba(255,255,255,.14) }
  .pd-grid{ display:grid; grid-template-columns:repeat(5, 1fr); gap:12px; margin-top:12px }
  @media (max-width:600px){ .pd-grid{ grid-template-columns:repeat(3,1fr) } }
  .pd-swatch{
    border:1px solid var(--pd-ring); border-radius:14px; background:var(--pd-card);
    display:grid; grid-template-rows: 80px auto;
  }
  .pd-swatch .box{ min-height:80px }
  .pd-swatch .meta{ padding:10px; display:grid; gap:6px }
  .pd-row{ display:flex; align-items:center; justify-content:space-between; gap:8px }
  .pd-swatch small{ color:var(--pd-muted); font-size:11px }

  /* Col. 3 : contraste + tokens + actions */
  .pd-preview{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
  @media (max-width:600px){ .pd-preview{ grid-template-columns:1fr } }
  .pd-demo{ border:1px solid var(--pd-ring); border-radius:12px; overflow:hidden }
  .pd-demo header{ display:flex; justify-content:space-between; padding:8px 10px; font-size:12px; color:var(--pd-muted); border-bottom:1px solid var(--pd-ring); background:var(--pd-card) }
  .pd-demo .box{ min-height:72px; padding:12px; font-size:14px }

  .pd-txt{ width:100%; min-height:120px; font:12px/1.4 ui-monospace,Menlo,Consolas,monospace;
    background:transparent; color:var(--pd-ink); border:1px dashed var(--pd-ring); border-radius:8px; padding:10px }

  /* Footer (raccourcis) */
  .pd-foot{
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding:10px clamp(12px, 4vw, 28px); border-top:1px solid var(--pd-ring); background:var(--pd-card); color:var(--pd-muted); font-size:12px;
  }
</style>

<div class="pd-overlay" id="pdOverlay" role="dialog" aria-label="Concepteur de palettes (plein Ã©cran)">
  <div class="pd-top">
    <div class="pd-title">ðŸŽ¨ Roue & Palettes â€” Plein Ã©cran</div>
    <div class="pd-actions">
      <button class="pd-btn" id="pdRandom">AlÃ©atoire</button>
      <button class="pd-btn" id="pdApply">Appliquer Ã  la page</button>
      <button class="pd-btn" id="pdClose">Fermer</button>
    </div>
  </div>

  <div class="pd-body">
    <!-- Col. 1 -->
    <div class="pd-section">
      <div class="pd-card">
        <h3 class="pd-h3">Roue HSL</h3>
        <div class="pd-canvas" id="pdCanvas">
          <canvas id="pdWheel" width="320" height="320"></canvas>
          <div class="pd-knob" id="pdKnob" style="left:160px; top:12px"></div>
        </div>
      </div>
      <div class="pd-card">
        <h3 class="pd-h3">RÃ©glages</h3>
        <div class="pd-sl">
          <label for="pdSat">Saturation</label>
          <input id="pdSat" type="range" min="0" max="100" value="80">
          <label for="pdLig">LuminositÃ©</label>
          <input id="pdLig" type="range" min="0" max="100" value="55">
        </div>
      </div>
    </div>

    <!-- Col. 2 -->
    <div class="pd-section">
      <div class="pd-card">
        <h3 class="pd-h3">Harmonies</h3>
        <div class="pd-modes">
          <button class="pd-chip" data-mode="complement">ComplÃ©mentaire</button>
          <button class="pd-chip" data-mode="triad">Triade</button>
          <button class="pd-chip" data-mode="tetrad">TÃ©trade</button>
          <button class="pd-chip" data-mode="analog">Analogues</button>
          <button class="pd-chip" data-mode="mono">Monochrome</button>
        </div>
        <div class="pd-grid" id="pdGrid"></div>
      </div>
    </div>

    <!-- Col. 3 -->
    <div class="pd-section">
      <div class="pd-card">
        <h3 class="pd-h3">Contraste (WCAG)</h3>
        <div class="pd-preview">
          <div class="pd-demo">
            <header><span>Fond clair</span><span id="pdAA1">â€”</span></header>
            <div class="box" id="pdDemoLight" style="background:#ffffff; color:#111">Aa â€” Titre & bouton</div>
          </div>
          <div class="pd-demo">
            <header><span>Fond sombre</span><span id="pdAA2">â€”</span></header>
            <div class="box" id="pdDemoDark" style="background:#0a0b10; color:#e8ecff">Aa â€” Titre & bouton</div>
          </div>
        </div>
      </div>
      <div class="pd-card">
        <h3 class="pd-h3">Tokens CSS</h3>
        <textarea class="pd-txt" id="pdTokens" readonly></textarea>
      </div>
    </div>
  </div>

  <div class="pd-foot">
    <div>Astuce : appuie sur <b>P</b> pour ouvrir/fermer, clique sur un code pour copier.</div>
    <div id="pdToast" aria-live="polite"></div>
  </div>
</div>

<script>
(function(){
  /* ==== helpers couleurs ==== */
  const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
  const hslToRgb=(h,s,l)=>{
    s/=100; l/=100; const k=n=>(n+(h/30))%12;
    const a=s*Math.min(l,1-l);
    const f=n=> l - a*Math.max(-1, Math.min(k(n)-3, Math.min(9-k(n),1)));
    return [Math.round(255*f(0)),Math.round(255*f(8)),Math.round(255*f(4))];
  };
  const rgbToHex=(r,g,b)=>'#'+[r,g,b].map(x=>x.toString(16).padStart(2,'0')).join('');
  const hslToHex=(h,s,l)=>rgbToHex(...hslToRgb(h,s,l));
  const hexToRgb=(hex)=>{ const m=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex); return m?[parseInt(m[1],16),parseInt(m[2],16),parseInt(m[3],16)]:[0,0,0]; };
  const luminance=(r,g,b)=>{ const t=[r,g,b].map(v=>{v/=255; return v<=.03928?v/12.92:Math.pow((v+0.055)/1.055,2.4)}); return 0.2126*t[0]+0.7152*t[1]+0.0722*t[2]; };
  const contrastRatio=(c1,c2)=>{ const [r1,g1,b1]=hexToRgb(c1),[r2,g2,b2]=hexToRgb(c2); const L1=luminance(r1,g1,b1)+0.05, L2=luminance(r2,g2,b2)+0.05; return Math.round(((L1>L2?L1/L2:L2/L1))*100)/100; };
  const wcag=(r)=> r>=7?'AAA': r>=4.5?'AA': r>=3?'AA (large)':'fail';
  const rot=(h,d)=>(((h+d)%360)+360)%360;

  /* ==== DOM ==== */
  const overlay = document.getElementById('pdOverlay');
  const wheel = document.getElementById('pdWheel');
  const ctx = wheel.getContext('2d');
  const knob = document.getElementById('pdKnob');
  const sat = document.getElementById('pdSat');
  const lig = document.getElementById('pdLig');
  const grid = document.getElementById('pdGrid');
  const tokens = document.getElementById('pdTokens');
  const demoL = document.getElementById('pdDemoLight');
  const demoD = document.getElementById('pdDemoDark');
  const a1 = document.getElementById('pdAA1');
  const a2 = document.getElementById('pdAA2');
  const toast = document.getElementById('pdToast');
  const btnClose = document.getElementById('pdClose');
  const btnRandom = document.getElementById('pdRandom');
  const btnApply = document.getElementById('pdApply');
  const chips = Array.from(document.querySelectorAll('.pd-chip'));

  let H=200, S=80, L=55, MODE='complement';

  /* ==== wheel ==== */
  function drawWheel(){
    const r=wheel.width/2, cx=r, cy=r;
    for(let deg=0;deg<360;deg++){
      const g=ctx.createRadialGradient(cx,cy,r*0.2,cx,cy,r);
      g.addColorStop(0, hslToHex(deg,20,50));
      g.addColorStop(1, hslToHex(deg,100,50));
      ctx.strokeStyle=g; ctx.beginPath();
      const a1=(deg-1)*Math.PI/180, a2=deg*Math.PI/180;
      ctx.arc(cx,cy,r-1,a1,a2); ctx.lineWidth=16; ctx.stroke();
    }
    ctx.beginPath(); ctx.arc(cx,cy,r*0.2,0,Math.PI*2);
    ctx.fillStyle='rgba(255,255,255,.06)'; ctx.fill();
  }

  const buildSet=()=>{
    const set=[];
    if(MODE==='complement'){
      set.push([H,S,L],[rot(H,180),S,L]);
    } else if(MODE==='triad'){
      set.push([H,S,L],[rot(H,120),S,L],[rot(H,-120),S,L]);
    } else if(MODE==='tetrad'){
      set.push([H,S,L],[rot(H,90),S,L],[rot(H,180),S,L],[rot(H,270),S,L]);
    } else if(MODE==='analog'){
      set.push([rot(H,-30),S,L],[H,S,L],[rot(H,15),S,L],[rot(H,30),S,L]);
    } else if(MODE==='mono'){
      set.push([H,S,clamp(L-20,0,100)],[H,S,L],[H,S,clamp(L+20,0,100)]);
    }
    while(set.length<5){ set.push([H,S,clamp(L + (set.length-2)*10,0,100)]) }
    return set.slice(0,5);
  };

  function render(){
    sat.value=S; lig.value=L;
    const r=wheel.width/2, cx=r, cy=r, ang=(H-90)*Math.PI/180;
    knob.style.left=(cx + (r-18)*Math.cos(ang))+'px';
    knob.style.top =(cy + (r-18)*Math.sin(ang))+'px';

    const set = buildSet();
    grid.innerHTML='';
    set.forEach(([h,s,l],i)=>{
      const hex=hslToHex(h,s,l);
      const el=document.createElement('div');
      el.className='pd-swatch';
      el.innerHTML=`
        <div class="box" style="background:${hex}"></div>
        <div class="meta">
          <div class="pd-row"><b>${i===0?'base':'var'+i}</b><button class="pd-btn" data-copy="${hex}">Copier</button></div>
          <small>${hex.toUpperCase()} â€¢ hsl(${h}, ${s}%, ${l}%)</small>
        </div>`;
      grid.appendChild(el);
    });

    const primary=hslToHex(H,S,L);
    demoL.style.color=primary; demoD.style.color=primary;
    a1.textContent='Contraste: '+wcag(contrastRatio(primary,'#ffffff'));
    a2.textContent='Contraste: '+wcag(contrastRatio(primary,'#0a0b10'));

    tokens.value=`:root{
  --acc: ${primary};
  --acc-2: ${hslToHex(rot(H,180),S,L)};
  --acc-tri-1: ${hslToHex(rot(H,120),S,L)};
  --acc-tri-2: ${hslToHex(rot(H,-120),S,L)};
  --acc-analog-1: ${hslToHex(rot(H,15),S,L)};
  --acc-analog-2: ${hslToHex(rot(H,-15),S,L)};
}`;
    // copier
    grid.querySelectorAll('[data-copy]').forEach(b=>{
      b.onclick=()=>{ navigator.clipboard.writeText(b.dataset.copy); toast.textContent='CopiÃ© '+b.dataset.copy; fireToast(); }
    });
  }

  function setHueFromPoint(x,y){
    const rect=wheel.getBoundingClientRect();
    const dx=x-rect.left-rect.width/2, dy=y-rect.top-rect.height/2;
    H=(Math.round(Math.atan2(dy,dx)*180/Math.PI + 90)+360)%360;
    render();
  }
  let dragging=false;
  wheel.addEventListener('pointerdown', e=>{ dragging=true; setHueFromPoint(e.clientX,e.clientY); wheel.setPointerCapture(e.pointerId) });
  wheel.addEventListener('pointermove', e=>{ if(dragging) setHueFromPoint(e.clientX,e.clientY) });
  wheel.addEventListener('pointerup', e=>{ dragging=false; try{wheel.releasePointerCapture(e.pointerId)}catch{} });

  sat.oninput=e=>{ S=+e.target.value; render() }
  lig.oninput=e=>{ L=+e.target.value; render() }
  chips.forEach(c=> c.addEventListener('click', ()=>{ chips.forEach(x=>x.classList.remove('active')); c.classList.add('active'); MODE=c.dataset.mode; render(); }));
  document.querySelector('.pd-chip[data-mode="complement"]').classList.add('active');

  /* ==== Random (curatÃ© + algo) ==== */
  const curated=[
    ['Vaporwave',[315,80,65],'triad'],
    ['Tropical', [170,75,50],'analog'],
    ['Arcade',   [200,90,55],'tetrad'],
    ['Sunset',   [18,85,58], 'complement'],
    ['Aurora',   [155,70,54],'analog'],
    ['Sakura',   [340,70,66],'mono'],
    ['Cyber',    [190,90,55],'tetrad'],
  ];
  function pickRandom(){
    if(Math.random()<0.6){
      const [name,[h,s,l],mode]=curated[Math.floor(Math.random()*curated.length)];
      H=h; S=s; L=l; MODE=mode;
      chips.forEach(x=>x.classList.toggle('active', x.dataset.mode===MODE));
      render(); toast.textContent=`Palette '${name}'`; fireToast();
    }else{
      H=Math.floor(Math.random()*360);
      S=[65,70,75,80,85][Math.floor(Math.random()*5)];
      L=[48,52,56,60,64][Math.floor(Math.random()*5)];
      const ms=['complement','triad','tetrad','analog','mono']; MODE=ms[Math.floor(Math.random()*ms.length)];
      chips.forEach(x=>x.classList.toggle('active', x.dataset.mode===MODE));
      render(); toast.textContent='Palette alÃ©atoire'; fireToast();
    }
  }
  btnRandom.onclick=pickRandom;

  /* ==== Appliquer Ã  la page (variables CSS) ==== */
  btnApply.onclick=()=>{
    const root=document.documentElement.style;
    root.setProperty('--acc',           hslToHex(H,S,L));
    root.setProperty('--acc-2',         hslToHex(rot(H,180),S,L));
    root.setProperty('--acc-tri-1',     hslToHex(rot(H,120),S,L));
    root.setProperty('--acc-tri-2',     hslToHex(rot(H,-120),S,L));
    root.setProperty('--acc-analog-1',  hslToHex(rot(H,15),S,L));
    root.setProperty('--acc-analog-2',  hslToHex(rot(H,-15),S,L));
    toast.textContent='Tokens appliquÃ©s Ã  :root'; fireToast();
  };

  /* ==== Open/Close + shortcuts ==== */
  btnClose.onclick=()=> overlay.classList.add('pd-hidden');
  document.addEventListener('keydown', e=>{
    if(e.key.toLowerCase()==='p'){ overlay.classList.toggle('pd-hidden') }
    if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='enter'){ btnApply.click() }
  });

  /* ==== Toast ==== */
  function fireToast(){
    toast.style.opacity='0'; toast.style.transition='none';
    requestAnimationFrame(()=>{
      toast.style.transition='opacity .3s ease, transform .3s ease';
      toast.style.opacity='1'; toast.style.transform='translateY(0)';
      setTimeout(()=>{ toast.style.opacity='0'; }, 1200);
    });
  }

  /* init */
  drawWheel(); render();
})();
</script>
<!-- ========== /FULLSCREEN PALETTE DESIGNER ========== -->
