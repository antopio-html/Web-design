<!-- ============ ðŸŽ¨ PALETTE â€” MOBILE APP UX (GROS TEXTE) ============ -->
<style>
  :root{
    --ui-bg: rgba(10,11,16,.96);
    --ui-card: rgba(255,255,255,.06);
    --ui-ring: rgba(255,255,255,.16);
    --ui-ink: #eef2ff;
    --ui-muted:#9fb0d3;
    --ui-acc:#2bd9ff; --ui-acc2:#ff3cac;
  }
  @media (prefers-color-scheme: light){
    :root{ --ui-bg: rgba(250,252,255,.98); --ui-card: rgba(0,0,0,.06); --ui-ring: rgba(0,0,0,.14); --ui-ink:#0e1116; --ui-muted:#4f5b73 }
  }

  .pal-app{
    position:fixed; inset:0; z-index:99999; background:var(--ui-bg);
    color:var(--ui-ink);
    display:grid; grid-template-rows:auto 1fr auto;
    font: clamp(18px, 4.8vw, 20px)/1.55 Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing:grayscale;
  }
  .pal-hidden{ display:none }

  /* Top bar */
  .pal-top{
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding: clamp(14px,5vw,20px);
    border-bottom:1px solid var(--ui-ring); background:var(--ui-card);
  }
  .pal-title{ font-weight:900; letter-spacing:.2px; font-size: clamp(22px, 6vw, 28px) }
  .btn{
    appearance:none; border:1px solid var(--ui-ring);
    background:linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
    color:inherit; border-radius:16px; padding:14px 18px; font-weight:800;
    min-height:48px; min-width:48px; cursor:pointer; touch-action:manipulation;
  }
  .btn.primary{
    background:linear-gradient(180deg, color-mix(in oklab, var(--ui-acc) 28%, transparent), transparent);
    box-shadow:0 10px 30px color-mix(in oklab, var(--ui-acc) 24%, transparent);
  }

  /* Views */
  .pal-views{ position:relative; overflow:auto; -webkit-overflow-scrolling:touch; }
  .view{
    padding: clamp(16px,5.5vw,24px);
    display:grid; gap: clamp(14px, 4vw, 18px);
  }
  .card{
    background:var(--ui-card); border:1px solid var(--ui-ring); border-radius:18px;
    padding: clamp(14px,4.5vw,18px); display:grid; gap: clamp(12px,3.5vw,16px);
  }
  .card h2{ margin:0; font-weight:900; font-size: clamp(22px,6.2vw,28px) }
  .sub{ color:var(--ui-muted) }

  /* Wheel */
  .wheel-wrap{ display:grid; gap:16px; place-items:center }
  .wheel{
    width: min(88vw, 420px); aspect-ratio:1/1; border-radius:50%;
    border:1px solid var(--ui-ring);
    background:radial-gradient(circle, rgba(255,255,255,.06), transparent 62%);
    position:relative; touch-action:none;
  }
  .wheel canvas{ width:100%; height:100%; display:block }
  .knob{
    position:absolute; width:26px; height:26px; border-radius:50%; background:#fff; border:2px solid #111;
    transform:translate(-50%,-50%); box-shadow:0 0 0 6px rgba(0,0,0,.18); pointer-events:none
  }

  .sliders{ width:100%; max-width:520px; display:grid; gap:14px }
  .sliders label{ color:var(--ui-muted) }
  .sliders input[type="range"]{ width:100%; height:52px; appearance:none; background:transparent }
  .sliders input[type="range"]::-webkit-slider-runnable-track{ height:12px; border-radius:999px; background:linear-gradient(90deg, var(--ui-acc), var(--ui-acc2)) }
  .sliders input[type="range"]::-webkit-slider-thumb{ appearance:none; width:34px; height:34px; border-radius:50%; background:#fff; border:2px solid #111; margin-top:-11px }
  .sliders input[type="range"]::-moz-range-track{ height:12px; border-radius:999px; background:linear-gradient(90deg, var(--ui-acc), var(--ui-acc2)) }
  .sliders input[type="range"]::-moz-range-thumb{ width:34px; height:34px; border-radius:50%; background:#fff; border:2px solid #111 }

  /* Chips + swatches */
  .chips{ display:flex; flex-wrap:wrap; gap:12px }
  .chip{
    padding:14px 16px; border-radius:16px; border:1px solid var(--ui-ring);
    background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.05));
    min-height:48px; font-weight:800;
  }
  .chip.active{ outline:2px solid color-mix(in oklab, var(--ui-acc) 34%, transparent) }

  .sw-grid{ display:grid; grid-template-columns:repeat(3, 1fr); gap:14px }
  @media (min-width: 680px){ .sw-grid{ grid-template-columns:repeat(5, 1fr) } }
  .sw{
    border:1px solid var(--ui-ring); border-radius:16px; overflow:hidden;
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    display:grid; grid-template-rows: 96px auto;
  }
  .sw .box{ min-height:96px }
  .meta{ padding:12px; display:grid; gap:8px }
  .row{ display:flex; align-items:center; justify-content:space-between; gap:12px }
  .copy{ padding:12px 14px; border-radius:12px; border:1px solid var(--ui-ring); background:transparent; min-height:44px; font-weight:800 }
  .small{ color:var(--ui-muted); font-size: .95em; word-break:break-all }

  /* Contrast + tokens */
  .preview{ display:grid; grid-template-columns:1fr; gap:14px }
  @media (min-width: 780px){ .preview{ grid-template-columns:1fr 1fr } }
  .demo{ border:1px solid var(--ui-ring); border-radius:16px; overflow:hidden }
  .demo header{ display:flex; justify-content:space-between; gap:12px; padding:12px 14px; color:var(--ui-muted); border-bottom:1px solid var(--ui-ring) }
  .demo .box{ min-height:84px; padding:14px; font-weight:900; font-size: clamp(20px, 5.5vw, 24px) }

  .tokens{ width:100%; min-height:160px; font: 15px/1.5 ui-monospace, Menlo, Consolas, monospace; background:transparent; color:var(--ui-ink); border:1px dashed var(--ui-ring); border-radius:14px; padding:14px }

  /* Bottom tabs */
  .tabs{
    display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px;
    padding: clamp(12px,5vw,18px);
    border-top:1px solid var(--ui-ring); background:var(--ui-card);
  }
  .tab{
    display:grid; place-items:center; gap:6px;
    padding:12px; border-radius:14px; border:1px solid var(--ui-ring); font-weight:900; min-height:48px;
    background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.05));
  }
  .tab.active{ outline:2px solid color-mix(in oklab, var(--ui-acc) 34%, transparent) }

  /* Reduce motion */
  @media (prefers-reduced-motion: reduce){
    .btn, .chip, .tab { transition: none !important }
  }
</style>

<div class="pal-app" id="palApp" role="dialog" aria-label="Palette â€” Mobile App UX">
  <div class="pal-top">
    <div class="pal-title">ðŸŽ¨ Palette (mobile)</div>
    <div class="pal-actions">
      <button class="btn" id="btnRand">AlÃ©atoire</button>
      <button class="btn primary" id="btnApply">Appliquer</button>
      <button class="btn" id="btnClose">Fermer</button>
    </div>
  </div>

  <!-- Views -->
  <div class="pal-views" id="views">
    <!-- Teinte -->
    <section class="view" data-view="hue">
      <div class="card">
        <h2>Teinte</h2>
        <div class="sub">Fais glisser ton doigt sur la roue. Ajuste Saturation & LuminositÃ© si besoin.</div>
        <div class="wheel-wrap">
          <div class="wheel" id="wheelWrap">
            <canvas id="wheel"></canvas>
            <div class="knob" id="knob"></div>
          </div>
          <div class="sliders">
            <label for="sat">Saturation</label>
            <input id="sat" type="range" min="0" max="100" value="80" />
            <label for="lig">LuminositÃ©</label>
            <input id="lig" type="range" min="0" max="100" value="55" />
          </div>
        </div>
      </div>
    </section>

    <!-- Harmonies -->
    <section class="view" data-view="harmonies">
      <div class="card">
        <h2>Harmonies</h2>
        <div class="chips" id="chips">
          <button class="chip" data-mode="complement">ComplÃ©mentaire</button>
          <button class="chip" data-mode="triad">Triade</button>
          <button class="chip" data-mode="tetrad">TÃ©trade</button>
          <button class="chip" data-mode="analog">Analogues</button>
          <button class="chip" data-mode="mono">Monochrome</button>
        </div>
      </div>

      <div class="card">
        <h2>Couleurs proposÃ©es</h2>
        <div class="sw-grid" id="swGrid"></div>
      </div>
    </section>

    <!-- Export -->
    <section class="view" data-view="export">
      <div class="card">
        <h2>Contraste</h2>
        <div class="preview">
          <div class="demo">
            <header><span>Fond clair</span><span id="AA1">â€”</span></header>
            <div class="box" id="DL" style="background:#ffffff; color:#111">Aa â€” Titre & bouton</div>
          </div>
          <div class="demo">
            <header><span>Fond sombre</span><span id="AA2">â€”</span></header>
            <div class="box" id="DD" style="background:#0a0b10; color:#eef2ff">Aa â€” Titre & bouton</div>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>Tokens CSS</h2>
        <textarea class="tokens" id="tokens" readonly></textarea>
      </div>
    </section>
  </div>

  <!-- Bottom tabs -->
  <nav class="tabs" aria-label="Navigation onglets">
    <button class="tab active" data-goto="hue">Teinte</button>
    <button class="tab" data-goto="harmonies">Harmonies</button>
    <button class="tab" data-goto="export">Export</button>
  </nav>
</div>

<script>
(()=> {
  /* ==== helpers ==== */
  const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
  const hslToRgb=(h,s,l)=>{ s/=100; l/=100; const k=n=>(n+(h/30))%12; const a=s*Math.min(l,1-l);
    const f=n=> l - a*Math.max(-1, Math.min(k(n)-3, Math.min(9-k(n),1)));
    return [Math.round(255*f(0)),Math.round(255*f(8)),Math.round(255*f(4))] };
  const rgbToHex=(r,g,b)=>'#'+[r,g,b].map(x=>x.toString(16).padStart(2,'0')).join('');
  const hslToHex=(h,s,l)=>rgbToHex(...hslToRgb(h,s,l));
  const hexToRgb=(hex)=>{ const m=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex); return m?[parseInt(m[1],16),parseInt(m[2],16),parseInt(m[3],16)]:[0,0,0] };
  const luminance=(r,g,b)=>{ const t=[r,g,b].map(v=>{v/=255; return v<=.03928?v/12.92:Math.pow((v+0.055)/1.055,2.4)}); return 0.2126*t[0]+0.7152*t[1]+0.0722*t[2] };
  const ratio=(c1,c2)=>{ const [r1,g1,b1]=hexToRgb(c1),[r2,g2,b2]=hexToRgb(c2); const L1=luminance(r1,g1,b1)+0.05, L2=luminance(r2,g2,b2)+0.05; return Math.round(((L1>L2?L1/L2:L2/L1))*100)/100 };
  const wcag=r=> r>=7?'AAA': r>=4.5?'AA': r>=3?'AA (large)':'fail';
  const rot=(h,d)=>(((h+d)%360)+360)%360;

  /* ==== DOM ==== */
  const app = document.getElementById('palApp');
  const btnClose = document.getElementById('btnClose');
  const btnRand = document.getElementById('btnRand');
  const btnApply = document.getElementById('btnApply');
  const tabs = Array.from(document.querySelectorAll('.tab'));
  const views = document.querySelectorAll('.view');

  // wheel
  const wheelWrap = document.getElementById('wheelWrap');
  const wheel = document.getElementById('wheel');
  const knob = document.getElementById('knob');
  const sat = document.getElementById('sat');
  const lig = document.getElementById('lig');

  // harmonies
  const chips = document.getElementById('chips');
  const swGrid = document.getElementById('swGrid');

  // export
  const AA1 = document.getElementById('AA1'), AA2 = document.getElementById('AA2');
  const DL = document.getElementById('DL'), DD = document.getElementById('DD');
  const tokens = document.getElementById('tokens');

  let H=200,S=80,L=55, MODE='complement';
  let dpr = Math.min(window.devicePixelRatio || 1, 2);

  /* ==== Tabs ==== */
  function goto(name){
    tabs.forEach(t=> t.classList.toggle('active', t.dataset.goto===name));
    views.forEach(v=> v.style.display = (v.dataset.view===name) ? 'grid' : 'none');
  }
  tabs.forEach(t=> t.addEventListener('click', ()=> goto(t.dataset.goto)));
  goto('hue'); // start

  /* ==== Wheel (DPR-aware) ==== */
  function drawWheel(){
    const size = Math.floor(wheelWrap.clientWidth * dpr);
    if(size<=0) return;
    wheel.width=size; wheel.height=size;
    const ctx = wheel.getContext('2d', { willReadFrequently:false });
    const r=size/2, cx=r, cy=r;
    ctx.clearRect(0,0,size,size);
    for(let deg=0;deg<360;deg++){
      const g=ctx.createRadialGradient(cx,cy, r*0.18, cx,cy, r*0.98);
      g.addColorStop(0, hslToHex(deg,20,50));
      g.addColorStop(1, hslToHex(deg,100,50));
      ctx.strokeStyle=g; ctx.beginPath();
      const a1=(deg-1)*Math.PI/180, a2=deg*Math.PI/180;
      ctx.arc(cx,cy,r-3,a1,a2); ctx.lineWidth=Math.max(16*dpr, 14); ctx.stroke();
    }
    ctx.beginPath(); ctx.arc(cx,cy,r*0.2,0,Math.PI*2);
    ctx.fillStyle='rgba(255,255,255,.08)'; ctx.fill();
    positionKnob();
  }
  function positionKnob(){
    const rect = wheelWrap.getBoundingClientRect();
    const r = rect.width/2;
    const ang = (H-90)*Math.PI/180;
    knob.style.left = (rect.width/2 + (r-18)*Math.cos(ang))+'px';
    knob.style.top  = (rect.height/2 + (r-18)*Math.sin(ang))+'px';
  }
  function hueFromPointer(x,y){
    const rect = wheelWrap.getBoundingClientRect();
    const dx = x - rect.left - rect.width/2;
    const dy = y - rect.top  - rect.height/2;
    H = (Math.round(Math.atan2(dy,dx)*180/Math.PI + 90) + 360) % 360;
    render();
  }
  let dragging=false;
  wheelWrap.addEventListener('pointerdown', e=>{ dragging=true; wheelWrap.setPointerCapture(e.pointerId); hueFromPointer(e.clientX,e.clientY) });
  wheelWrap.addEventListener('pointermove', e=>{ if(dragging) hueFromPointer(e.clientX,e.clientY) });
  wheelWrap.addEventListener('pointerup',   e=>{ dragging=false; try{wheelWrap.releasePointerCapture(e.pointerId)}catch{} });

  sat.addEventListener('input', e=>{ S=+e.target.value; render() });
  lig.addEventListener('input', e=>{ L=+e.target.value; render() });

  /* ==== Harmonies ==== */
  chips.querySelectorAll('.chip').forEach(b=>{
    if(b.dataset.mode==='complement') b.classList.add('active');
    b.addEventListener('click', ()=>{
      chips.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
      b.classList.add('active'); MODE=b.dataset.mode; render();
    });
  });

  function buildSet(){
    let set=[];
    if(MODE==='complement'){ set=[[H,S,L],[rot(H,180),S,L]]; }
    else if(MODE==='triad'){ set=[[H,S,L],[rot(H,120),S,L],[rot(H,-120),S,L]]; }
    else if(MODE==='tetrad'){ set=[[H,S,L],[rot(H,90),S,L],[rot(H,180),S,L],[rot(H,270),S,L]]; }
    else if(MODE==='analog'){ set=[[rot(H,-30),S,L],[H,S,L],[rot(H,15),S,L],[rot(H,30),S,L]]; }
    else if(MODE==='mono'){ set=[[H,S,clamp(L-20,0,100)],[H,S,L],[H,S,clamp(L+20,0,100)]]; }
    while(set.length<5){ set.push([H,S,clamp(L+(set.length-2)*10,0,100)]) }
    return set.slice(0,5);
  }

  /* ==== Render ==== */
  function render(){
    positionKnob();

    // swatches (gros)
    swGrid.innerHTML='';
    const set = buildSet();
    set.forEach(([h,s,l],i)=>{
      const hex=hslToHex(h,s,l);
      const el=document.createElement('div');
      el.className='sw';
      el.innerHTML=`<div class="box" style="background:${hex}"></div>
        <div class="meta">
          <div class="row"><b>${i===0?'base':'var'+i}</b><button class="copy" data-copy="${hex}">Copier</button></div>
          <div class="small">${hex.toUpperCase()} â€¢ hsl(${h}, ${s}%, ${l}%)</div>
        </div>`;
      swGrid.appendChild(el);
    });
    swGrid.querySelectorAll('[data-copy]').forEach(b=>{
      b.onclick=()=> navigator.clipboard.writeText(b.dataset.copy);
      b.onpointerdown=(e)=>{ let t=setTimeout(()=>b.click(), 450); ['pointerup','pointercancel','pointerleave'].forEach(ev=>b.addEventListener(ev,()=>clearTimeout(t),{once:true})) };
    });

    // contraste
    const primary = hslToHex(H,S,L);
    DL.style.color=primary; DD.style.color=primary;
    AA1.textContent='Contraste: '+wcag(ratio(primary,'#ffffff'));
    AA2.textContent='Contraste: '+wcag(ratio(primary,'#0a0b10'));

    // tokens
    tokens.value = `:root{
  --acc: ${primary};
  --acc-2: ${hslToHex(rot(H,180),S,L)};
  --acc-tri-1: ${hslToHex(rot(H,120),S,L)};
  --acc-tri-2: ${hslToHex(rot(H,-120),S,L)};
  --acc-analog-1: ${hslToHex(rot(H,15),S,L)};
  --acc-analog-2: ${hslToHex(rot(H,-15),S,L)};
}`;
  }

  /* ==== Random + Apply ==== */
  const curated=[
    ['Vaporwave',[315,80,65],'triad'],
    ['Tropical', [170,75,50],'analog'],
    ['Arcade',   [200,90,55],'tetrad'],
    ['Sunset',   [18,85,58], 'complement'],
    ['Aurora',   [155,70,54],'analog'],
    ['Sakura',   [340,70,66],'mono'],
    ['Cyber',    [190,90,55],'tetrad'],
  ];
  function randomize(){
    if(Math.random()<0.6){
      const [_,[h,s,l],mode]=curated[Math.floor(Math.random()*curated.length)];
      H=h; S=s; L=l; MODE=mode;
    }else{
      H=Math.floor(Math.random()*360);
      S=[65,70,75,80,85][Math.floor(Math.random()*5)];
      L=[48,52,56,60,64][Math.floor(Math.random()*5)];
      MODE=['complement','triad','tetrad','analog','mono'][Math.floor(Math.random()*5)];
    }
    chips.querySelectorAll('.chip').forEach(x=>x.classList.toggle('active', x.dataset.mode===MODE));
    render();
  }
  btnRand.onclick=randomize;

  btnApply.onclick=()=>{
    const root=document.documentElement.style;
    root.setProperty('--acc',           hslToHex(H,S,L));
    root.setProperty('--acc-2',         hslToHex(rot(H,180),S,L));
    root.setProperty('--acc-tri-1',     hslToHex(rot(H,120),S,L));
    root.setProperty('--acc-tri-2',     hslToHex(rot(H,-120),S,L));
    root.setProperty('--acc-analog-1',  hslToHex(rot(H,15),S,L));
    root.setProperty('--acc-analog-2',  hslToHex(rot(H,-15),S,L));
  };

  btnClose.onclick=()=> app.classList.add('pal-hidden');
  document.addEventListener('keydown', e=>{ if(e.key.toLowerCase()==='p'){ app.classList.toggle('pal-hidden') }});

  /* ==== Resize ==== */
  function onResize(){ dpr=Math.min(window.devicePixelRatio||1,2); drawWheel(); render(); }
  window.addEventListener('resize', onResize, {passive:true});
  onResize();
})();
</script>
<!-- ========== /MOBILE APP UX ========== -->
