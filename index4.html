<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1, viewport-fit=cover" />
<title>PRISM — Roue & Palette (centrées, 5 colonnes)</title>
<style>
  :root{
    --bg:#0b0f16; --ink:#f2f6ff; --muted:#9fb0d3; --ring:rgba(255,255,255,.16);
    --card:rgba(255,255,255,.06); --acc:#6C66FA; --acc-2:#FA66F4;
    --pad: clamp(14px, 5vw, 22px); --container: 1080px;
  }
  @media (prefers-color-scheme: light){
    :root{ --bg:#f7faff; --ink:#0e1116; --muted:#4e5a73; --ring:rgba(0,0,0,.14); --card:rgba(0,0,0,.06) }
  }

  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);
    font: clamp(18px,4.6vw,20px)/1.6 Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; overflow-x:hidden}
  *{box-sizing:border-box}

  .container{max-width:var(--container); margin-inline:auto; padding-inline:var(--pad)}

  header{position:sticky; top:0; z-index:10; border-bottom:1px solid var(--ring);
    background: color-mix(in oklab, var(--card) 82%, transparent); backdrop-filter: blur(10px) saturate(140%)}
  .head-inner{display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding-block: max(10px, env(safe-area-inset-top)) 10px}
  .brand{font-weight:900; letter-spacing:.3px; display:flex; align-items:center; gap:.6em}
  .dot{width:12px;height:12px;border-radius:50%;background:linear-gradient(180deg,var(--acc),var(--acc-2));box-shadow:0 0 14px var(--acc)}
  .btn{appearance:none; border:1px solid var(--ring); background:linear-gradient(180deg,rgba(255,255,255,.14),rgba(255,255,255,.06));
    color:inherit; border-radius:16px; padding:12px 16px; font-weight:900; min-height:44px}
  .btn.primary{background:linear-gradient(180deg,color-mix(in oklab,var(--acc) 28%, transparent), transparent);
    box-shadow:0 8px 26px color-mix(in oklab,var(--acc) 24%, transparent)}

  main{padding-block: var(--pad)}

  .panel{background:var(--card); border:1px solid var(--ring); border-radius:18px;
    padding: clamp(12px,4.5vw,18px); display:grid; gap: clamp(10px,3.5vw,16px); margin-block: var(--pad)}
  h1{margin:0; font-weight:900; font-size: clamp(22px,6.6vw,32px)}
  h2{margin:0; font-weight:900; font-size: clamp(20px,6vw,26px)}
  .sub{color:var(--muted)}

  /* ROUE — plus petite, centrée, non coupée */
  .wheel-wrap{ width:100%; display:grid; place-items:center; gap:14px; margin-inline:auto }
  .wheel{
    width: min(78vw, 420px);           /* ⬅️ roue réduite */
    max-width: 420px;
    aspect-ratio:1/1; border-radius:50%;
    border:1px solid var(--ring);
    background:radial-gradient(circle, rgba(255,255,255,.06), transparent 62%);
    position:relative; touch-action:none; margin-inline:auto;
  }
  .wheel canvas{ width:100%; height:100%; display:block }
  .knob{ position:absolute; width:26px; height:26px; border-radius:50%; background:#fff; border:2px solid #111;
         transform:translate(-50%,-50%); box-shadow:0 0 0 6px rgba(0,0,0,.18); pointer-events:none }
  .sliders{ width:100%; max-width:520px; display:grid; gap:12px; margin-inline:auto }
  .sliders label{ color:var(--muted) }
  input[type="range"]{ width:100%; height:50px; appearance:none; background:transparent }
  input[type="range"]::-webkit-slider-runnable-track{ height:10px; border-radius:999px; background:linear-gradient(90deg,var(--acc),var(--acc-2))}
  input[type="range"]::-webkit-slider-thumb{ appearance:none; width:32px;height:32px;border-radius:50%; background:#fff; border:2px solid #111; margin-top:-11px }
  input[type="range"]::-moz-range-track{ height:10px; border-radius:999px; background:linear-gradient(90deg,var(--acc),var(--acc-2))}
  input[type="range"]::-moz-range-thumb{ width:32px;height:32px;border-radius:50%; background:#fff; border:2px solid #111 }

  .toolbar{ display:flex; flex-wrap:wrap; gap:10px; justify-content:center }
  .chip{padding:10px 14px; border-radius:14px; border:1px solid var(--ring); background:linear-gradient(180deg,rgba(255,255,255,.12),rgba(255,255,255,.05)); font-weight:800; min-height:42px}
  .chip.active{ outline:2px solid color-mix(in oklab, var(--acc) 34%, transparent) }

  /* BARRE PALETTE — toujours 5 colonnes, wrap auto en 2 lignes si manque de place */
  .bar{ background:var(--card); border:1px solid var(--ring); border-radius:18px; padding: clamp(8px,3vw,12px) }
  .bar-grid{
    display:grid;
    grid-template-columns: repeat(5, 1fr);   /* ⬅️ 5 sur la largeur */
    gap: clamp(6px,2vw,10px);
  }
  @media (max-width: 360px){
    .bar-grid{ grid-template-columns: repeat(5, minmax(0, 1fr)); } /* force 2 lignes si nécessaire */
  }
  .slot{ border:1px solid var(--ring); border-radius:14px; overflow:hidden;
         display:grid; grid-template-rows: min(14svh, 120px) auto }  /* ⬅️ éléments un peu plus petits */
  .swatch{ width:100%; height:100% }
  .hex{ padding:8px; text-align:center; font-weight:900; letter-spacing:.3px;
        font-family: ui-monospace, Menlo, Consolas, monospace; position:relative }
  .baseMark{ position:absolute; left:50%; top:-6px; transform:translateX(-50%); font-size:16px }

  .preview{display:grid; gap:10px}
  .pane{border:1px solid var(--ring); border-radius:16px; overflow:hidden}
  .pane header{display:flex; justify-content:space-between; gap:10px; padding:10px 12px; color:var(--muted); border-bottom:1px solid var(--ring); background:color-mix(in oklab,var(--card) 72%, transparent)}
  .pane .box{min-height:86px; padding:12px; font-weight:900; font-size: clamp(18px,5.2vw,22px)}
  textarea.tokens{width:100%; min-height:140px; font:15px/1.5 ui-monospace,Menlo,Consolas,monospace; color:var(--ink); background:transparent; border:1px dashed var(--ring); border-radius:14px; padding:12px}

  .actions{display:flex; flex-wrap:wrap; gap:8px; justify-content:center}

  /* Thème “force” (appliquer au site) */
  .themed-hard *{ accent-color: var(--acc) !important; }
  .themed-hard a, .themed-hard a:visited{ color: var(--acc) !important; }
  .themed-hard button, .themed-hard .btn{ background: linear-gradient(180deg, color-mix(in oklab, var(--acc) 26%, transparent), transparent) !important; border-color: color-mix(in oklab, var(--acc) 38%, var(--ring)) !important; color: var(--ink) !important; }
  .themed-hard input, .themed-hard select, .themed-hard textarea{ border-color: color-mix(in oklab, var(--acc) 38%, var(--ring)) !important; color: var(--ink) !important; background: color-mix(in oklab, var(--card) 75%, transparent) !important; }
  .themed-hard ::selection{ background: color-mix(in oklab, var(--acc) 55%, transparent); color:#000 }
  .themed-hard .panel, .themed-hard .bar, .themed-hard .pane, .themed-hard textarea.tokens{ border-color: color-mix(in oklab, var(--acc) 38%, var(--ring)) !important; box-shadow: 0 0 0 1px color-mix(in oklab, var(--acc) 20%, transparent) inset !important; }
  .themed-hard h1, .themed-hard h2, .themed-hard h3{ color: var(--ink) !important; text-shadow: 0 0 18px color-mix(in oklab, var(--acc) 35%, transparent) }
</style>
</head>
<body>
  <header>
    <div class="container head-inner">
      <div class="brand"><span class="dot"></span> PRISM — Générateur</div>
      <div class="actions">
        <button class="btn" id="random">Aléatoire</button>
        <button class="btn primary" id="apply">Appliquer au site</button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- ROUE -->
    <section class="panel">
      <h1>Roue chromatique</h1>
      <p class="sub">Glisse sur la roue pour la teinte. Ajuste saturation / luminosité.</p>
      <div class="wheel-wrap">
        <div class="wheel" id="wheelWrap">
          <canvas id="wheel"></canvas>
          <div class="knob" id="knob"></div>
        </div>
        <div class="sliders">
          <label for="sat">Saturation</label>
          <input id="sat" type="range" min="0" max="100" value="80" />
          <label for="lig">Luminosité</label>
          <input id="lig" type="range" min="0" max="100" value="55" />
        </div>
      </div>
    </section>

    <!-- Harmonies -->
    <section class="panel">
      <div class="toolbar" id="modes">
        <button class="chip" data-mode="analog">Analogues</button>
        <button class="chip" data-mode="complement">Complémentaire</button>
        <button class="chip" data-mode="triad">Triade</button>
        <button class="chip" data-mode="tetrad">Tétrade</button>
        <button class="chip" data-mode="mono">Monochrome</button>
      </div>
    </section>

    <!-- Palette (5 colonnes) -->
    <section class="bar">
      <div class="bar-grid" id="barGrid"></div>
    </section>

    <!-- Aperçu & export -->
    <section class="panel">
      <h2>Contraste & export</h2>
      <div class="preview">
        <div class="pane">
          <header><span>Fond clair</span><span id="wcagLight">—</span></header>
          <div class="box" id="demoLight" style="background:#ffffff; color:#111">Aa — Titre & Bouton</div>
        </div>
        <div class="pane">
          <header><span>Fond sombre</span><span id="wcagDark">—</span></header>
          <div class="box" id="demoDark" style="background:#0b0f16; color:#f2f6ff">Aa — Titre & Bouton</div>
        </div>
      </div>
      <textarea class="tokens" id="tokens" readonly></textarea>
      <div class="actions">
        <button class="btn" id="copyCss">Copier CSS</button>
        <button class="btn" id="copyJson">Copier JSON</button>
      </div>
    </section>
  </main>

<script>
/* ===== Helpers ===== */
const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
const rgbToHex=(r,g,b)=>'#'+[r,g,b].map(x=>x.toString(16).padStart(2,'0')).join('');
const hslToRgb=(h,s,l)=>{ s/=100; l/=100; const k=n=>(n+(h/30))%12; const a=s*Math.min(l,1-l);
  const f=n=> l - a*Math.max(-1, Math.min(k(n)-3, Math.min(9-k(n),1)));
  return [Math.round(255*f(0)),Math.round(255*f(8)),Math.round(255*f(4))] };
const hslToHex=(h,s,l)=>rgbToHex(...hslToRgb(h,s,l));
const hexToRgb=(hex)=>{ const m=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex); return m?[parseInt(m[1],16),parseInt(m[2],16),parseInt(m[3],16)]:[0,0,0] };
const luminance=(r,g,b)=>{ const t=[r,g,b].map(v=>{v/=255; return v<=.03928?v/12.92:Math.pow((v+0.055)/1.055,2.4)}); return 0.2126*t[0]+0.7152*t[1]+0.0722*t[2] };
const contrastRatio=(hex1,hex2)=>{ const [r1,g1,b1]=hexToRgb(hex1),[r2,g2,b2]=hexToRgb(hex2); const L1=luminance(r1,g1,b1)+0.05, L2=luminance(r2,g2,b2)+0.05; return Math.round((L1>L2?L1/L2:L2/L1)*100)/100 };
const wcag=r=> r>=7?'AAA': r>=4.5?'AA': r>=3?'AA (large)':'fail';
const rot=(h,d)=>(((h+d)%360)+360)%360;

/* ===== DOM ===== */
const wheelWrap = document.getElementById('wheelWrap');
const wheel = document.getElementById('wheel');
const knob = document.getElementById('knob');
const sat = document.getElementById('sat');
const lig = document.getElementById('lig');
const modes = document.getElementById('modes');
const barGrid = document.getElementById('barGrid');
const demoL = document.getElementById('demoLight');
const demoD = document.getElementById('demoDark');
const wcagL = document.getElementById('wcagLight');
const wcagD = document.getElementById('wcagDark');
const tokens = document.getElementById('tokens');
const randomBtn = document.getElementById('random');
const applyBtn = document.getElementById('apply');
const copyCss = document.getElementById('copyCss');
const copyJson = document.getElementById('copyJson');

/* ===== State ===== */
let H=264, S=80, L=60;     // base
let MODE='analog';
let dpr = Math.min(window.devicePixelRatio||1, 2);

/* ===== Wheel (smaller, centered) ===== */
function drawWheel(){
  const w = Math.floor(wheelWrap.getBoundingClientRect().width * dpr);
  if(w<=0) return;
  wheel.width=w; wheel.height=w;
  const ctx = wheel.getContext('2d', { willReadFrequently:false });
  const r=w/2, cx=r, cy=r;
  ctx.clearRect(0,0,w,w);
  for(let deg=0;deg<360;deg++){
    const g=ctx.createRadialGradient(cx,cy, r*0.18, cx,cy, r*0.98);
    g.addColorStop(0, hslToHex(deg,20,50));
    g.addColorStop(1, hslToHex(deg,100,50));
    ctx.strokeStyle=g; ctx.beginPath();
    const a1=(deg-1)*Math.PI/180, a2=deg*Math.PI/180;
    ctx.arc(cx,cy,r-3,a1,a2); ctx.lineWidth=Math.max(16*dpr, 14); ctx.stroke();
  }
  ctx.beginPath(); ctx.arc(cx,cy,r*0.2,0,Math.PI*2);
  ctx.fillStyle='rgba(255,255,255,.08)'; ctx.fill();
  positionKnob();
}
function positionKnob(){
  const rect = wheelWrap.getBoundingClientRect();
  const r = rect.width/2;
  const ang = (H-90)*Math.PI/180;
  knob.style.left = (rect.width/2 + (r-18)*Math.cos(ang))+'px';
  knob.style.top  = (rect.height/2 + (r-18)*Math.sin(ang))+'px';
}
function hueFromPointer(x,y){
  const rect = wheelWrap.getBoundingClientRect();
  const dx = x - rect.left - rect.width/2;
  const dy = y - rect.top  - rect.height/2;
  H = (Math.round(Math.atan2(dy,dx)*180/Math.PI + 90) + 360) % 360;
  render();
}
let dragging=false;
wheelWrap.addEventListener('pointerdown', e=>{ dragging=true; wheelWrap.setPointerCapture(e.pointerId); hueFromPointer(e.clientX,e.clientY) });
wheelWrap.addEventListener('pointermove', e=>{ if(dragging) hueFromPointer(e.clientX,e.clientY) });
wheelWrap.addEventListener('pointerup',   e=>{ dragging=false; try{wheelWrap.releasePointerCapture(e.pointerId)}catch{} });

sat.addEventListener('input', e=>{ S=+e.target.value; render() });
lig.addEventListener('input', e=>{ L=+e.target.value; render() });

/* ===== Modes ===== */
modes.querySelectorAll('.chip').forEach(b=>{
  if(b.dataset.mode===MODE) b.classList.add('active');
  b.addEventListener('click', ()=>{
    modes.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
    b.classList.add('active'); MODE=b.dataset.mode; render();
  });
});

/* ===== Build palette (toujours 5, base au CENTRE) ===== */
function buildSet5(){
  // offsets en degrés autour de la base (centre = 0)
  let offsets=[];
  if(MODE==='analog')       offsets=[-30, -15, 0, 15, 30];
  else if(MODE==='complement') offsets=[-180, -30, 0, 30, 180];
  else if(MODE==='triad')   offsets=[-120, -30, 0, 30, 120];
  else if(MODE==='tetrad')  offsets=[-90, 0, 90, 180, -45]; // 4 teintes clés + un intermédiaire
  else if(MODE==='mono')    return [
                               [H,S,clamp(L-24,0,100)],
                               [H,S,clamp(L-12,0,100)],
                               [H,S,L],                // centre = base
                               [H,S,clamp(L+12,0,100)],
                               [H,S,clamp(L+24,0,100)]
                             ];
  return offsets.map(d=>[rot(H,d), S, L]);
}

/* ===== Render ===== */
function render(){
  positionKnob();

  // Palette 5 colonnes (base au centre + marque ▲)
  const set = buildSet5();
  barGrid.innerHTML='';
  set.forEach(([h,s,l],i)=>{
    const hex=hslToHex(h,s,l);
    const el=document.createElement('div');
    el.className='slot';
    el.innerHTML=`<div class="swatch" style="background:${hex}"></div>
      <div class="hex">${i===2?'<span class="baseMark">▲</span>':''}${hex.toUpperCase()}</div>`;
    barGrid.appendChild(el);
  });

  // Contraste (cohérent avec la roue : base = set[2])
  const baseHex = hslToHex(H,S,L);
  demoL.style.color=baseHex; demoD.style.color=baseHex;
  wcagL.textContent='Contraste: '+wcag(contrastRatio(baseHex,'#ffffff'));
  wcagD.textContent='Contraste: '+wcag(contrastRatio(baseHex,'#0b0f16'));

  // Export CSS
  tokens.value = `:root{
  --acc: ${baseHex};
  --acc-2: ${hslToHex(rot(H,180),S,L)};
  --acc-tri-1: ${hslToHex(rot(H,120),S,L)};
  --acc-tri-2: ${hslToHex(rot(H,-120),S,L)};
  --acc-analog-1: ${hslToHex(rot(H,15),S,L)};
  --acc-analog-2: ${hslToHex(rot(H,-15),S,L)};
}`;
}

/* ===== Actions ===== */
const curated=[ ['Vaporwave',[315,80,65],'triad'], ['Tropical',[170,75,50],'analog'],
  ['Arcade',[200,90,55],'tetrad'], ['Sunset',[18,85,58],'complement'],
  ['Aurora',[155,70,54],'analog'], ['Sakura',[340,70,66],'mono'], ['Cyber',[190,90,55],'tetrad'] ];
randomBtn?.addEventListener('click', ()=>{
  if(Math.random()<0.6){ const [_,[h,s,l],m]=curated[Math.floor(Math.random()*curated.length)]; [H,S,L]=[h,s,l]; MODE=m; }
  else{ H=Math.floor(Math.random()*360); S=[65,70,75,80,85][Math.floor(Math.random()*5)];
        L=[48,52,56,60,64][Math.floor(Math.random()*5)];
        MODE=['analog','complement','triad','tetrad','mono'][Math.floor(Math.random()*5)]; }
  modes.querySelectorAll('.chip').forEach(x=>x.classList.toggle('active', x.dataset.mode===MODE));
  render();
});

applyBtn.addEventListener('click', ()=>{
  const root=document.documentElement.style;
  root.setProperty('--acc',           hslToHex(H,S,L));
  root.setProperty('--acc-2',         hslToHex(rot(H,180),S,L));
  document.documentElement.classList.add('themed-hard');
});

copyCss.onclick=()=> navigator.clipboard.writeText(tokens.value);
copyJson.onclick=()=>{
  const obj = { acc: hslToHex(H,S,L), acc2: hslToHex(rot(H,180),S,L),
    tri1: hslToHex(rot(H,120),S,L), tri2: hslToHex(rot(H,-120),S,L),
    analog1: hslToHex(rot(H,15),S,L), analog2: hslToHex(rot(H,-15),S,L) };
  navigator.clipboard.writeText(JSON.stringify(obj,null,2));
};

/* ===== Init & Resize ===== */
function onResize(){ dpr=Math.min(window.devicePixelRatio||1,2); drawWheel(); render(); }
window.addEventListener('resize', onResize, {passive:true});
onResize();
</script>
</body>
</html>
