<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bar √† Chat ‚Äî Exp√©rience d√©filante (contr√¥le doux + retour intro)</title>
<meta name="description" content="Bienvenue au Bar √† Chat. Scroll classique, grand espace, puis exp√©rience 3D avec cartes dynamiques et images.">
<style>
  :root{
    --bg1:#f8f3ec; --bg2:#f3e7da; --ink:#2b2623; --muted:#6d625b;
    --primary:#c98552; --accent:#79c9bf; --rose:#f0a9b7;
    --panel:#ffffff; --line:#eadccd; --radius:18px; --focus:#e08aa0;
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0}
  body{
    color:var(--ink);
    font: clamp(14px, 1.2vw, 16px)/1.6 Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Arial, sans-serif;
    -webkit-tap-highlight-color: transparent;
    background:
      radial-gradient(1200px 700px at 80% -10%, rgba(201,133,82,.12), transparent 60%),
      radial-gradient(900px 600px at 10% 30%, rgba(240,169,183,.12), transparent 60%),
      linear-gradient(180deg, var(--bg1), var(--bg2));
  }
  body.lock{ overflow:hidden; } /* seulement pendant l‚Äôexp√©rience 3D */

  /* ----------- Zone classique ----------- */
  header.site{
    position:sticky; top:0; z-index:10;
    background:linear-gradient(to bottom, rgba(255,255,255,.85), rgba(255,255,255,.0));
    border-bottom:1px solid var(--line); backdrop-filter: blur(8px) saturate(1.05);
  }
  .nav{display:flex; justify-content:space-between; align-items:center; max-width:1100px; margin:auto; padding:12px 20px;}
  .brand{display:flex; gap:10px; align-items:center; font-weight:800; letter-spacing:.4px}
  .mug{width:18px; height:18px; border-radius:4px 4px 10px 10px; position:relative;
    background:linear-gradient(180deg, var(--primary), #b77448);
    box-shadow:0 6px 14px rgba(201,133,82,.35) inset, 0 1px 0 rgba(255,255,255,.6)}
  .mug:after{content:""; position:absolute; right:-6px; top:4px; width:8px; height:8px; border:3px solid #b77448; border-left-color:transparent; border-bottom-color:transparent; border-radius:50%}

  .hero{max-width:1100px; margin:24px auto 0; padding:28px 20px 10px; display:grid; grid-template-columns:1.2fr .8fr; gap:26px; align-items:center;}
  @media (max-width:920px){ .hero{ grid-template-columns:1fr; } }
  .hero h1{ font-size: clamp(28px, 5vw, 48px); margin:.2rem 0 .4rem }
  .lead{ color:var(--muted); font-size: clamp(15px, 2.2vw, 18px) }
  .cta{ display:inline-block; margin-top:10px; padding:10px 14px; border-radius:999px; font-weight:700;
        background:#fff; border:1px solid var(--line); box-shadow:0 8px 18px rgba(90,60,30,.12); color:var(--ink); }
  .welcome{ max-width:1100px; margin:18px auto 0; padding:0 20px; display:grid; gap:18px; grid-template-columns:repeat(3,1fr); }
  @media (max-width:920px){ .welcome{ grid-template-columns:1fr; } }
  .tile{ border:1px solid var(--line); background:#fff; border-radius:16px; padding:16px; box-shadow:0 8px 20px rgba(90,60,30,.08); }
  .tile h3{ margin:.2rem 0 .4rem }

  /* Gros espace avant l‚Äôexp√©rience */
  .spacer{
    height: 160vh; /* ‚Üê plus d‚Äôespace visible pour respirer avant les cartes */
    display:flex; align-items:center; justify-content:center;
    color:var(--muted);
  }

  /* pattes d√©coratives */
  .paws{
    position:fixed; inset:-40px; z-index:0; pointer-events:none; opacity:.08; mix-blend-mode:multiply;
    background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="220" height="220" viewBox="0 0 220 220"><g fill="%23c8b6a6"><circle cx="40" cy="40" r="10"/><circle cx="65" cy="30" r="8"/><circle cx="25" cy="25" r="8"/><circle cx="50" cy="60" r="8"/><path d="M85 85c18-12 34 8 20 20s-38 2-20-20z"/></g></svg>') repeat;
    background-size:220px 220px; animation:paws 14s linear infinite;
  }
  @keyframes paws { to { transform: translate(110px,110px) } }

  /* ----------- Section EXP√âRIENCE ----------- */
  section#experience{
    position:relative; height:100vh; display:flex; align-items:center; justify-content:center;
  }
  .enterBox{ text-align:center; border:1px solid var(--line); background:#fff; border-radius:18px; padding:18px 16px; box-shadow:0 10px 26px rgba(90,60,30,.12); max-width:min(640px, 92vw); }
  .enterBox h2{ margin:.2rem 0 .3rem }
  .enterBtn{ margin-top:10px; padding:10px 14px; border-radius:999px; font-weight:700; border:1px solid var(--line); background:#fff; }
  .enterHint{ position:absolute; bottom:14px; left:50%; transform:translateX(-50%); font-size:12px; color:var(--muted); background:rgba(255,255,255,.75); border:1px solid var(--line); border-radius:999px; padding:6px 10px; backdrop-filter: blur(6px); }

  /* HUD exp√©rience (visible quand actif) */
  header.hud3d{
    position:fixed; inset:0 0 auto 0; z-index:20; display:none;
    align-items:center; justify-content:space-between;
    padding: clamp(8px, 2.5vw, 14px) clamp(12px, 3vw, 22px);
    background:linear-gradient(to bottom, rgba(255,255,255,.85), rgba(255,255,255,0));
    border-bottom:1px solid var(--line); backdrop-filter: blur(8px) saturate(1.05);
  }
  body.experience header.hud3d{ display:flex; }
  .hudRow{display:flex; align-items:center; gap:10px; color:var(--muted); font-size:12px}
  .bar{width: clamp(120px, 30vw, 200px); height:6px; border-radius:999px; background:#e9ded1; overflow:hidden; border:1px solid var(--line)}
  .bar>i{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--primary),var(--rose))}
  .state{padding:4px 8px; border-radius:999px; border:1px solid var(--line); background:#fff; color:var(--muted)}
  .brandSmall{display:flex; gap:10px; align-items:center; font-weight:800; letter-spacing:.4px}

  /* Boutons flottants */
  .ctrls{position:fixed; right:12px; bottom:72px; z-index:22; display:none; flex-direction:column; gap:10px}
  body.experience .ctrls{ display:flex; }
  .ctrls button{width:50px; height:50px; border-radius:14px; border:1px solid var(--line); background:#fff; color:var(--ink); box-shadow:0 10px 24px rgba(90,60,30,.12); font-size:18px; touch-action:none}
  .exitIntro{ position:fixed; left:12px; bottom:72px; z-index:22; display:none; }
  body.experience .exitIntro{ display:block; }
  .exitIntro button{ width:50px; height:50px; border-radius:14px; border:1px solid var(--line); background:#fff; color:var(--ink); box-shadow:0 10px 24px rgba(90,60,30,.12); font-size:18px; }

  /* Viewport 3D */
  .viewport{position:fixed; inset:0; overflow:hidden; perspective: clamp(820px, 85vw, 1100px); perspective-origin:50% 50%; touch-action:none; display:none;}
  body.experience .viewport{ display:block; }
  .scene{position:absolute; inset:0; transform-style:preserve-3d; will-change:transform}

  /* Layers & cards */
  .layer{position:absolute; top:50%; left:50%; transform-style:preserve-3d; will-change:transform,opacity,filter; opacity:var(--o,1); filter: blur(var(--blur, 0px)) saturate(1.02)}
  .card{
    min-width:min(560px, 92vw);
    padding: clamp(14px, 3.2vw, 22px);
    border-radius: var(--radius);
    background:linear-gradient(180deg, var(--panel), #fffaf6);
    border:1px solid var(--line);
    box-shadow: 0 18px 40px rgba(90,60,30,.12), 0 1px 0 rgba(255,255,255,.8) inset;
    position:relative;
  }
  .card:before,.card:after{content:""; position:absolute; top:-12px; width:26px; height:26px; background:var(--panel); border:1px solid var(--line); transform: rotate(45deg)}
  .card:before{left:28px; border-bottom:none; border-right:none}
  .card:after{right:28px; border-bottom:none; border-left:none}

  .card h2{margin:.2rem 0 .4rem; font-size: clamp(18px, 4.5vw, 24px)}
  .card p{color:var(--muted); margin:.2rem 0; font-size: clamp(13px, 3.7vw, 15px)}

  .media{ margin-top:10px; border-radius:14px; overflow:hidden; border:1px solid #efdfd1; background:#fff; box-shadow:0 10px 18px rgba(90,60,30,.08); }
  .media img{ width:100%; height:auto; display:block; }

  .chip{display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px;
        background:linear-gradient(180deg,#fff,#fde9e9); color:#7a3b44; border:1px solid #f1d1d8; margin-right:6px}
  .chip.mint{ background:linear-gradient(180deg,#fff,#e9f7f5); color:#2b605a; border-color:#cfece8 }
  .chip.caramel{ background:linear-gradient(180deg,#fff,#f5e6d8); color:#7b4a2c; border-color:#ecd7c3 }

  .focused .card{border-color:var(--focus); box-shadow:0 24px 56px rgba(224,138,160,.28), 0 0 0 1px rgba(255,255,255,.6) inset, 0 0 0 2px rgba(224,138,160,.16)}

  /* Footer */
  footer{max-width:1100px; margin:40px auto; padding:0 20px 40px; color:var(--muted)}
</style>
</head>
<body>

<div class="paws" aria-hidden="true"></div>

<!-- Intro -->
<header class="site">
  <nav class="nav">
    <div class="brand"><span class="mug" aria-hidden="true"></span> Bar √† Chat</div>
    <a class="cta" href="#experience">Entrer dans l‚Äôexp√©rience ‚Üì</a>
  </nav>
</header>

<section class="hero" id="top">
  <div>
    <h1>Bienvenue au Bar √† Chat</h1>
    <p class="lead">Un endroit cosy pour savourer un cappuccino, rencontrer nos pensionnaires et soutenir l‚Äôadoption responsable.</p>
    <a class="cta" href="#experience">D√©couvrir l‚Äôexp√©rience 3D</a>
  </div>
  <div class="tile" style="align-self:stretch;">
    <h3>Horaires & Ambiance</h3>
    <p>Ouvert tous les jours de 10h √† 20h. Espace calme, livres, plaid, wifi ‚Äî et des chats heureux üêæ</p>
    <p>Faites d√©filer vers le bas pour entrer dans l‚Äôexp√©rience ‚Äútunnel 3D‚Äù.</p>
  </div>
</section>

<section class="welcome">
  <div class="tile"><h3>Adoptions</h3><p>Avec nos associations partenaires, nous facilitons l‚Äôadoption responsable.</p></div>
  <div class="tile"><h3>√âthique</h3><p>Bien-√™tre f√©lin : repos, soins, zones calmes et r√®gles claires.</p></div>
  <div class="tile"><h3>√âv√®nements</h3><p>Ateliers, lectures, rencontres ‚Äî suivez nos r√©seaux pour les dates.</p></div>
</section>

<!-- GRAND ESPACE -->
<section class="spacer" aria-hidden="true">
  <div>On se pr√©pare‚Ä¶ bient√¥t l‚Äôexp√©rience ‚ú®</div>
</section>

<!-- Entr√©e exp√©rience -->
<section id="experience" aria-label="Entr√©e exp√©rience 3D">
  <div class="enterBox">
    <h2>Pr√™t¬∑e ?</h2>
    <p>En continuant, d√©couvrez nos cartes avec images : Concept, Chats, Menu, Engagements, Nous trouver.</p>
    <button class="enterBtn" id="enterBtn">Entrer</button>
  </div>
  <div class="enterHint">Swipe/Scroll doux ‚Ä¢ ‚ÄúEntrer‚Äù pour d√©marrer</div>
</section>

<!-- HUD exp√©rience -->
<header class="hud3d" id="hud">
  <div class="brandSmall"><span class="mug" aria-hidden="true"></span> Exp√©rience ‚Äî Bar √† Chat</div>
  <div class="hudRow">
    <div class="bar" title="Progression"><i id="prog"></i></div>
    <span id="depthVal">Z: 0</span>
    <span class="state" id="state">Mode: libre</span>
  </div>
</header>

<!-- Boutons flottants -->
<div class="ctrls" aria-label="Contr√¥les">
  <button id="back" aria-label="Reculer">‚óÑ</button>
  <button id="fw" aria-label="Avancer">‚ñ∫</button>
</div>
<!-- Retour √† l‚Äôintro -->
<div class="exitIntro"><button id="exitBtn" title="Retour √† l‚Äôintro">‚Üë</button></div>

<!-- Viewport 3D -->
<div class="viewport" id="viewport" aria-label="Sc√®ne 3D">
  <div class="scene" id="scene">
    <!-- 5 cartes avec images (imagesBar/imageBar1.png ‚Ä¶ imageBar5.png) -->
    <div class="layer" data-z="-3200" data-dir="-1">
      <div class="card">
        <span class="chip caramel">Concept</span>
        <h2>Le concept</h2>
        <p>Un caf√© chaleureux o√π l‚Äôon partage un moment avec des chats adoptables, soutenu par des associations.</p>
        <div class="media"><img src="imagesBar/imageBar1.png" alt="Illustration du concept du bar √† chat"></div>
      </div>
    </div>
    <div class="layer" data-z="-2400" data-dir="1">
      <div class="card">
        <span class="chip mint">Chats</span>
        <h2>Nos chats</h2>
        <p>Des boules de poils curieuses et c√¢lines. Respect du rythme, zones de repos, interaction douce.</p>
        <div class="media"><img src="imagesBar/imageBar2.png" alt="Photo de chats du bar √† chat"></div>
      </div>
    </div>
    <div class="layer" data-z="-1600" data-dir="-1">
      <div class="card">
        <span class="chip caramel">Menu</span>
        <h2>Au menu</h2>
        <p>Cappuccino, latte, p√¢tisseries maison, options v√©g√©tales‚Ä¶ et eau fra√Æche pour nos f√©lins.</p>
        <div class="media"><img src="imagesBar/imageBar3.png" alt="Image de boissons et p√¢tisseries du menu"></div>
      </div>
    </div>
    <div class="layer" data-z="-800" data-dir="1">
      <div class="card">
        <span class="chip">Engagements</span>
        <h2>Nos engagements</h2>
        <p>Bien-√™tre animal, hygi√®ne irr√©prochable, partenariats transparents, sensibilisation et adoptions responsables.</p>
        <div class="media"><img src="imagesBar/imageBar4.png" alt="Illustration de nos engagements et valeurs"></div>
      </div>
    </div>
    <div class="layer" data-z="0" data-dir="-1">
      <div class="card">
        <span class="chip mint">Nous trouver</span>
        <h2>Comment nous trouver</h2>
        <p>Adresse, transports, stationnement et horaires ‚Äî tout pour venir sans stress.</p>
        <div class="media"><img src="imagesBar/imageBar5.png" alt="Carte d‚Äôacc√®s ou plan pour nous trouver"></div>
      </div>
    </div>
  </div>
</div>

<footer>
  <p>¬© Bar √† Chat ‚Äî Merci de votre visite. Revenez pour un cappuccino‚Ä¶ et des ronrons üò∫</p>
</footer>

<script>
/* ==== Exp√©rience contr√¥l√©e : retour intro facile + scroll tr√®s doux ==== */
(function(){
  const expSection = document.getElementById('experience');
  const enterBtn = document.getElementById('enterBtn');
  const exitBtn  = document.getElementById('exitBtn');

  const scene = document.getElementById('scene');
  const viewport = document.getElementById('viewport');
  const layers = Array.from(document.querySelectorAll('.layer'));
  const prog = document.getElementById('prog');
  const depthText = document.getElementById('depthVal');
  const stateText = document.getElementById('state');
  const btnFw = document.getElementById('fw');
  const btnBk = document.getElementById('back');

  let active = false; // exp√©rience en cours ?

  /* Param√®tres assouplis (plus lents, plus stables) */
  const cfg = {
    zMin: -3600, zMax: 800,
    blurMax: 10, visibilityZ: 1700,
    tiltMax: 3.2, scaleClampMin: .35, scaleClampMax: 1.85,

    /* >>> d√©filement lent et pr√©cis */
    SPEED: 0.45,          // wheel
    TOUCH_SENS: 0.85,     // touch
    KEY_STEP: 90,         // clavier
    BTN_STEP: 120,        // boutons

    SNAP_WIN: 150, DWELL_MS: 1200, BREAK_FORCE: 620,
    STICK_MS: 700, STICK_FACTOR: 0.38, FADE_STICK_PX: 260,

    SIDE_MAX: 320, SIDE_EASE: 0.85,
    VEL_CAP: 500          // vitesse max tr√®s limit√©e
  };

  let targetZ = cfg.zMin, camZ = cfg.zMin, vZ = 0;
  let tiltX=0, tiltY=0, ttx=0, tty=0;
  let mode = 'free', dwellTimer = 0, focusedIndex = -1;
  let stick = { active:false, index:-1, startCamZ:0, startTime:0 };

  const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));
  const lerp = (a,b,t)=>a+(b-a)*t;

  function setMode(m){ mode=m; stateText.textContent='Mode: '+(m==='dwell'?'pause':'libre'); }
  function updateHUD(){
    const p = (camZ - cfg.zMin) / (cfg.zMax - cfg.zMin);
    prog.style.width = (clamp(p,0,1)*100).toFixed(1)+'%';
    depthText.textContent = `Z: ${Math.round(camZ)}`;
  }
  function nearestLayerIndex(z){
    let best=-1,dmin=1e9;
    for(let i=0;i<layers.length;i++){ const z0=+layers[i].dataset.z||0, d=Math.abs(z0-z); if(d<dmin){dmin=d; best=i;} }
    return best;
  }

  function enterDwell(i){
    focusedIndex=i; const z0=+layers[i].dataset.z||0;
    targetZ=z0; vZ=0; dwellTimer=performance.now()+cfg.DWELL_MS; setMode('dwell');
    layers.forEach(L=>L.classList.remove('focused')); layers[i].classList.add('focused'); stick.active=false;
  }
  function beginStick(i){ stick={active:true,index:i,startCamZ:camZ,startTime:performance.now()}; }
  function exitDwell(startStick=true){
    const i=focusedIndex; setMode('free'); layers.forEach(L=>L.classList.remove('focused'));
    dwellTimer=0; focusedIndex=-1; if(startStick && i>=0) beginStick(i);
  }

  function sideOffset(depth, dir){
    if(depth<=0) return 0;
    const t = clamp(depth/800, 0, 1);
    const eased = 1 - Math.pow(1 - t, cfg.SIDE_EASE);
    return eased * cfg.SIDE_MAX * dir;
  }

  /* Activation / sortie de l‚Äôexp√©rience */
  function enterExperience(){
    if(active) return;
    active = true;
    document.body.classList.add('experience','lock');
    targetZ = cfg.zMin; camZ = cfg.zMin; vZ = 0;
    window.scrollTo({top: expSection.offsetTop, behavior:'instant'});
  }
  function exitExperience(){
    if(!active) return;
    active = false;
    document.body.classList.remove('experience','lock');
  }

  enterBtn.addEventListener('click', ()=>{ enterExperience(); });
  exitBtn.addEventListener('click', ()=>{
    exitExperience();
    document.getElementById('top').scrollIntoView({behavior:'smooth', block:'start'});
  });
  // ESC pour quitter
  addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ exitBtn.click(); } });

  /* Quitter si l‚Äôutilisateur remonte au-dessus de la section */
  addEventListener('scroll', ()=>{
    if(active){
      const top = expSection.getBoundingClientRect().top;
      if(top > 40){ // la section a quitt√© l‚Äô√©cran vers le bas => on quitte
        exitExperience();
      }
    }
  }, {passive:true});

  /* Guard: n‚Äô√©couter les gestes que pendant l‚Äôexp√©rience */
  function activeGuard(fn){ return function(e){ if(!active) return; fn(e); }; }

  /* Tilt */
  addEventListener('pointermove', activeGuard(e=>{
    const cx=innerWidth/2, cy=innerHeight/2;
    tty = ((e.clientX - cx)/cx) * cfg.tiltMax;
    ttx = (-(e.clientY - cy)/cy) * cfg.tiltMax;
  }), {passive:true});

  /* Wheel ‚Äî lent */
  addEventListener('wheel', activeGuard(e=>{
    const impulse = e.deltaY * cfg.SPEED;
    if(mode==='dwell'){
      if(Math.abs(impulse)>=cfg.BREAK_FORCE){ exitDwell(true); vZ += impulse; }
    } else vZ += impulse;
    vZ = clamp(vZ, -cfg.VEL_CAP, cfg.VEL_CAP);
    e.preventDefault();
  }), {passive:false});

  /* Touch ‚Äî lent */
  let touching=false, lastY=0, lastT=0;
  viewport.addEventListener('touchstart', activeGuard(e=>{
    touching=true; vZ*=0.3; lastY=e.touches[0].clientY; lastT=performance.now();
  }), {passive:true});
  viewport.addEventListener('touchmove', activeGuard(e=>{
    if(!touching) return;
    const y=e.touches[0].clientY, dy=(lastY-y)*cfg.TOUCH_SENS;
    const now=performance.now(), dt=Math.max(16, now-lastT);
    let impulse=(dy*16/dt)*10; // ‚Üì encore plus doux
    if(mode==='dwell'){
      if(Math.abs(impulse)>=cfg.BREAK_FORCE){ exitDwell(true); vZ += impulse; }
    } else vZ += impulse;
    vZ = clamp(vZ, -cfg.VEL_CAP, cfg.VEL_CAP);
    lastY=y; lastT=now; e.preventDefault();
  }), {passive:false});
  addEventListener('touchend', ()=>{ touching=false; }, {passive:true});

  /* Boutons (petits pas) */
  let holdFw=false, holdBk=false;
  btnFw.addEventListener('pointerdown', activeGuard(()=>{ if(mode==='dwell') exitDwell(true); holdFw=true; vZ -= cfg.BTN_STEP; vZ=clamp(vZ,-cfg.VEL_CAP,cfg.VEL_CAP); }));
  btnBk.addEventListener('pointerdown', activeGuard(()=>{ if(mode==='dwell') exitDwell(true); holdBk=true; vZ += cfg.BTN_STEP; vZ=clamp(vZ,-cfg.VEL_CAP,cfg.VEL_CAP); }));
  addEventListener('pointerup', ()=>{ holdFw=false; holdBk=false; });

  /* Clavier */
  addEventListener('keydown', activeGuard(e=>{
    const k=e.key.toLowerCase();
    if(k==='arrowdown'||k==='pagedown'){ if(mode==='dwell') exitDwell(true); vZ -= cfg.KEY_STEP*2; }
    if(k==='arrowup'  ||k==='pageup'  ){ if(mode==='dwell') exitDwell(true); vZ += cfg.KEY_STEP*2; }
    vZ = clamp(vZ, -cfg.VEL_CAP, cfg.VEL_CAP);
  }));

  function maybeEnterDwell(){
    if(mode==='dwell') return;
    const i = nearestLayerIndex(camZ), z0=+layers[i].dataset.z||0, d=Math.abs(z0-camZ);
    if(d <= cfg.SNAP_WIN && Math.abs(vZ) < 50){ enterDwell(i); targetZ=z0; }
  }

  function render(){
    if(active){
      if(mode!=='dwell'){
        if(holdFw) vZ -= 8;
        if(holdBk) vZ += 8;
        vZ = clamp(vZ, -cfg.VEL_CAP, cfg.VEL_CAP);
      }

      if(mode==='dwell'){
        if(focusedIndex>=0){ const z0=+layers[focusedIndex].dataset.z||0; targetZ=z0; }
        vZ *= 0.78;
        if(performance.now() >= dwellTimer) exitDwell(true);
      } else {
        targetZ += vZ;
        vZ *= 0.88; // ‚Üê damping plus fort = moins ‚Äúfou‚Äù
      }

      targetZ = clamp(targetZ, cfg.zMin, cfg.zMax);
      camZ = lerp(camZ, targetZ, 0.10);

      /* tilt */
      tiltX = lerp(tiltX, ttx, 0.10); tiltY = lerp(tiltY, tty, 0.10);
      scene.style.transform = `rotateX(${tiltX}deg) rotateY(${tiltY}deg)`;

      maybeEnterDwell();

      const now = performance.now();
      for(let i=0;i<layers.length;i++){
        const L = layers[i];
        const z0 = +L.dataset.z||0;
        const dir = Math.sign(+L.dataset.dir || (i%2?1:-1)) || 1;

        let depth = z0 - camZ;

        if(stick.active && stick.index===i){
          const t = clamp((now - stick.startTime)/cfg.STICK_MS, 0, 1);
          const follow = (camZ - stick.startCamZ) * cfg.STICK_FACTOR * (1 - t);
          depth += follow;
          if(t>=1) stick.active=false;
        }

        const xSide = (depth>0) ? sideOffset(depth, dir) : 0;

        const scale = clamp( 1 / (1 + (depth/1100)), cfg.scaleClampMin, cfg.scaleClampMax );
        let distFade = Math.abs(depth);
        if(stick.active && stick.index===i){
          const t = clamp((now - stick.startTime)/cfg.STICK_MS, 0, 1);
          distFade = Math.max(0, distFade - (1 - t)*cfg.FADE_STICK_PX);
        }
        const o = clamp(1 - (distFade/cfg.visibilityZ), 0, 1);
        const blur = (1 - Math.max(0, 1 - distFade/900)) * cfg.blurMax;
        const yOffset = depth/46;

        L.style.transform =
          `translate(-50%,-50%) translateX(${xSide}px) translateZ(${depth}px) translateY(${yOffset}px) `+
          `scale(${scale}) rotateX(${tiltX*0.28}deg) rotateY(${tiltY*0.28}deg)`;
        L.style.setProperty('--o', o.toFixed(3));
        L.style.setProperty('--blur', blur.toFixed(2)+'px');
        if(o < 0.05) L.setAttribute('aria-hidden','true'); else L.removeAttribute('aria-hidden');
      }

      updateHUD();
    }
    requestAnimationFrame(render);
  }
  render();

  /* Active l‚Äôexp√©rience quand la section est vraiment √† l‚Äô√©cran */
  const io = new IntersectionObserver((entries)=>{
    entries.forEach(e=>{
      if(e.isIntersecting && e.intersectionRatio > 0.75){
        // n‚Äôactive pas automatiquement : on laisse le bouton ‚ÄúEntrer‚Äù d√©cider
      }
    });
  }, {threshold:[0,0.75,1]});
  io.observe(expSection);

  /* Quand on active manuellement */
  document.querySelectorAll('a[href="#experience"]').forEach(a=>{
    a.addEventListener('click', (ev)=>{ ev.preventDefault(); document.getElementById('experience').scrollIntoView({behavior:'smooth'}); setTimeout(enterExperience, 450); });
  });
})();
</script>
</body>
</html>
