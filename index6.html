<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Dashboard Bento ‚Äî Flux publics</title>
<style>
:root{
  --bg1:#0b1021; --bg2:#0a1427; --card:rgba(17,24,39,.9);
  --ink:#f1f5f9; --muted:#94a3b8;
  --accent:#22d3ee; --accent2:#10b981; --gold:#d4a65a;
  --radius:18px; --ring:1px solid rgba(255,255,255,.08);
  --shadow1:0 6px 18px rgba(0,0,0,.35); --shadow2:0 16px 32px rgba(0,0,0,.45);
}
*{box-sizing:border-box;margin:0;padding:0}
body{font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Arial;
     background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--ink);}
img{max-width:100%;display:block}
a{color:var(--accent);text-decoration:none}
.container{width:min(1200px,92vw);margin:auto}

header{position:sticky;top:0;z-index:50;background:rgba(10,18,39,.85);
       backdrop-filter:blur(10px) saturate(140%);border-bottom:var(--ring)}
.bar{display:flex;align-items:center;justify-content:space-between;padding:14px 0}
h1{font-size:clamp(22px,3.2vw,32px)}
.btn{padding:8px 14px;border-radius:12px;background:#1e293b;color:#e2e8f0;border:var(--ring)}
.btn:hover{background:#334155}

/* Grille bento UNIFORME */
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:18px;margin:24px 0}
@media(max-width:1100px){.grid{grid-template-columns:repeat(6,1fr)}}
@media(max-width:700px){.grid{grid-template-columns:1fr}}

.card{background:var(--card);border:var(--ring);border-radius:var(--radius);
      box-shadow:var(--shadow1);overflow:hidden;display:flex;flex-direction:column;
      animation:rise .7s ease both}
.card:hover{transform:translateY(-3px);box-shadow:var(--shadow2)}
.media{aspect-ratio:16/9;overflow:hidden;background:#111;display:grid;place-items:center}
.media img,.media iframe{width:100%;height:100%;object-fit:cover}
.p{padding:16px}
.card h2{font-size:20px;margin:0 0 .4rem}
.meta{color:var(--muted);font-size:.9rem;margin-bottom:.4rem}
.small{font-size:.85rem;color:var(--muted)}

.span12{grid-column:span 12}
.span6{grid-column:span 6}

/* Animations */
@keyframes rise{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}

footer{border-top:var(--ring);margin-top:30px}
.foot{display:flex;justify-content:space-between;align-items:center;padding:16px 0;color:var(--muted);font-size:.9rem}
</style>
</head>
<body>
<header>
  <div class="container bar">
    <h1>üåç Dashboard ‚Äî Flux publics</h1>
    <button class="btn" id="refreshBtn">‚Üª Rafra√Æchir</button>
  </div>
</header>

<main class="container grid">
  <!-- Bandes sup√©rieures : tout en span6 pour coh√©rence -->
  <article class="card span6" id="apodCard">
    <div class="media" id="apodMedia"><span class="p">Chargement NASA APOD‚Ä¶</span></div>
    <div class="p"><h2>NASA APOD</h2><div class="meta" id="apodMeta"></div><p id="apodDesc"></p></div>
  </article>

  <article class="card span6" id="potdCard">
    <div class="media" id="potdMedia"><span class="p">Chargement POTD‚Ä¶</span></div>
    <div class="p"><h2>Wikimedia POTD</h2><div class="meta" id="potdMeta"></div><p id="potdDesc"></p></div>
  </article>

  <article class="card span6" id="esaCard">
    <div class="media" id="esaMedia"><span class="p">Chargement ESA‚Ä¶</span></div>
    <div class="p"><h2>ESA ‚Äî Image of the Week</h2><div class="meta" id="esaMeta"></div></div>
  </article>

  <article class="card span6" id="metCard">
    <div class="media" id="metMedia"><span class="p">Chargement Met‚Ä¶</span></div>
    <div class="p"><h2>Met Museum</h2><div class="meta" id="metMeta"></div></div>
  </article>

  <article class="card span6" id="eqCard">
    <div class="p"><h2>S√©ismes r√©cents (USGS)</h2>
      <ul id="eqList" style="list-style:none;display:grid;gap:6px;padding:0;margin:0"></ul>
    </div>
  </article>

  <article class="card span6" id="spxCard">
    <div class="p"><h2>SpaceX ‚Äî Dernier lancement</h2>
      <div class="meta" id="spxMeta"></div><div id="spxContent"></div>
    </div>
  </article>

  <article class="card span6" id="wxCard">
    <div class="p"><h2>M√©t√©o extr√™mes (aujourd‚Äôhui)</h2>
      <ul id="wxList" style="list-style:none;display:grid;gap:6px;padding:0;margin:0"></ul>
      <div class="small" id="wxNote"></div>
    </div>
  </article>

  <!-- NOUVELLE CARTE : agr√©gateur Actus (AFP + BBC) -->
  <article class="card span6" id="newsCard">
    <div class="p"><h2>Actus ‚Äî AFP & BBC</h2>
      <ul id="newsList" style="list-style:none;display:grid;gap:6px;padding:0;margin:0"></ul>
      <div class="small" id="newsNote"></div>
    </div>
  </article>
</main>

<footer>
  <div class="container foot">
    <div>¬© Flux publics ‚Äî NASA, ESA, AFP, BBC, Met, USGS, SpaceX, Open-Meteo, Wikimedia</div>
    <div>Made with ‚ô•</div>
  </div>
</footer>

<script>
const $=s=>document.querySelector(s);

/* NASA APOD (uniforme) */
async function loadAPOD(){
  try{
    const j=await (await fetch("https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY&thumbs=true")).json();
    $('#apodMedia').innerHTML=j.media_type==="video"
      ? `<iframe src="${j.url}" frameborder="0" allowfullscreen></iframe>`
      : `<img src="${j.hdurl||j.url}" alt="${j.title}">`;
    $('#apodMeta').textContent=`${j.title} ‚Äî ${j.date}`;
    $('#apodDesc').textContent=j.explanation||"";
  }catch(e){$('#apodMedia').innerHTML="<div class='p'>√âchec NASA APOD</div>";}
}

/* Wikimedia POTD (fallback si CORS) */
async function loadPOTD(){
  const d=new Date();
  const url=`https://commons.wikimedia.org/api/rest_v1/feed/featured/${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,"0")}/${String(d.getDate()).padStart(2,"0")}`;
  try{
    const j=await (await fetch(url)).json();
    const pic=j?.image?.image?.source||j?.tfa?.thumbnail?.source;
    if(pic) $('#potdMedia').innerHTML=`<img src="${pic}" alt="POTD">`;
    $('#potdMeta').textContent=j?.tfa?.title||"";
    $('#potdDesc').textContent=j?.tfa?.extract||"";
  }catch(e){
    $('#potdMedia').innerHTML="<div class='p small'>Impossible de charger Wikimedia. <a href='https://commons.wikimedia.org/wiki/Commons:Picture_of_the_day' target='_blank'>Voir POTD</a></div>";
  }
}

/* ESA (RSS) ‚Äî fallback lien si CORS bloque l'image */
async function loadESA(){
  try{
    const txt=await (await fetch("https://www.esa.int/rssfeed/Our_Activities/Observing_the_Earth")).text();
    const doc=new DOMParser().parseFromString(txt,"application/xml");
    const item=doc.querySelector("item");
    const title=item?.querySelector("title")?.textContent||"ESA ‚Äî Image of the Week";
    const link=item?.querySelector("link")?.textContent||"https://www.esa.int/";
    // CORS emp√™che souvent l'image dans <description>. On affiche un lien propre :
    $('#esaMedia').innerHTML=`<a href="${link}" target="_blank" class="p small">Ouvrir l‚Äôimage/Article sur le site ESA</a>`;
    $('#esaMeta').textContent=title;
  }catch(e){
    $('#esaMedia').innerHTML="<div class='p'>√âchec ESA</div>";
  }
}

/* Met Museum */
async function loadMet(){
  try{
    const ids=await (await fetch("https://collectionapi.metmuseum.org/public/collection/v1/search?hasImages=true&q=painting")).json();
    const id=ids.objectIDs[Math.floor(Math.random()*ids.objectIDs.length)];
    const j=await (await fetch(`https://collectionapi.metmuseum.org/public/collection/v1/objects/${id}`)).json();
    $('#metMedia').innerHTML=`<img src="${j.primaryImageSmall}" alt="${j.title}">`;
    $('#metMeta').textContent=`${j.title} ‚Äî ${j.artistDisplayName||"Inconnu"}`;
  }catch(e){$('#metMedia').innerHTML="<div class='p'>√âchec Met Museum</div>";}
}

/* USGS S√©ismes */
async function loadEQ(){
  try{
    const j=await (await fetch("https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson")).json();
    const top=j.features.sort((a,b)=>b.properties.mag-a.properties.mag).slice(0,5);
    $('#eqList').innerHTML=top.map(f=>{
      const d=new Date(f.properties.time);
      return `<li>${f.properties.mag.toFixed(1)} ‚Äî ${f.properties.place} <span class="small">(${d.toLocaleString()})</span></li>`;
    }).join("");
  }catch(e){$('#eqList').innerHTML="<li>√âchec USGS</li>";}
}

/* SpaceX */
async function loadSPX(){
  try{
    const j=await (await fetch("https://api.spacexdata.com/v5/launches/latest")).json();
    $('#spxMeta').textContent=`${j.name} ‚Äî ${new Date(j.date_utc).toLocaleString()}`;
    $('#spxContent').innerHTML=j.details||"Pas de d√©tails.";
  }catch(e){$('#spxMeta').textContent="√âchec SpaceX";}
}

/* Open-Meteo ‚Äî extr√™mes du jour (√©chantillon de villes repr√©sentatives) */
const cities=[
  {name:"Riyad, Arabie Saoudite",lat:24.7,lon:46.7},
  {name:"Kowe√Øt City, Kowe√Øt",lat:29.3,lon:47.5},
  {name:"Duba√Ø, EAU",lat:25.2,lon:55.3},
  {name:"New Delhi, Inde",lat:28.6,lon:77.2},
  {name:"Le Caire, √âgypte",lat:30.0,lon:31.2},
  {name:"Santiago, Chili",lat:-33.4,lon:-70.6},
  {name:"Anchorage, USA",lat:61.2,lon:-149.9},
  {name:"Oulan-Bator, Mongolie",lat:47.9,lon:106.9},
  {name:"Moscou, Russie",lat:55.7,lon:37.6},
  {name:"Montr√©al, Canada",lat:45.5,lon:-73.6},
  {name:"Sydney, Australie",lat:-33.9,lon:151.2},
  {name:"Casablanca, Maroc",lat:33.6,lon:-7.6}
];
async function loadWX(){
  $('#wxList').innerHTML="Chargement m√©t√©o‚Ä¶";
  let maxT=-999,minT=999,hot=null,cold=null,errs=0;
  for(const c of cities){
    try{
      const url=`https://api.open-meteo.com/v1/forecast?latitude=${c.lat}&longitude=${c.lon}&daily=temperature_2m_max,temperature_2m_min&forecast_days=1&timezone=auto`;
      const j=await (await fetch(url)).json();
      const tmax=j.daily.temperature_2m_max[0];
      const tmin=j.daily.temperature_2m_min[0];
      if(tmax>maxT){maxT=tmax;hot={city:c.name,temp:tmax};}
      if(tmin<minT){minT=tmin;cold={city:c.name,temp:tmin};}
    }catch(e){errs++}
  }
  if(hot && cold){
    $('#wxList').innerHTML=`
      <li>üå°Ô∏è Plus chaud : <strong>${hot.temp}¬∞C</strong> ‚Äî ${hot.city}</li>
      <li>‚ùÑÔ∏è Plus froid : <strong>${cold.temp}¬∞C</strong> ‚Äî ${cold.city}</li>`;
    $('#wxNote').textContent = "Bas√© sur un √©chantillon de grandes villes (couverture rapide, non exhaustive).";
  }else{
    $('#wxList').innerHTML="<li>√âchec Open-Meteo</li>";
  }
}

/* Actus agr√©g√©es ‚Äî AFP + BBC (RSS) */
const feeds = [
  {name:"AFP", url:"https://www.afp.com/en/news-hub/rss"},
  {name:"BBC World", url:"https://feeds.bbci.co.uk/news/world/rss.xml"}
];
async function loadNews(){
  const all=[];
  for(const f of feeds){
    try{
      const txt=await (await fetch(f.url)).text();
      const doc=new DOMParser().parseFromString(txt,"application/xml");
      const items=[...doc.querySelectorAll("item")].slice(0,6).map(n=>({
        src:f.name,
        title:n.querySelector("title")?.textContent||"Sans titre",
        link:n.querySelector("link")?.textContent||"#",
        date:new Date(n.querySelector("pubDate")?.textContent||Date.now())
      }));
      all.push(...items);
    }catch(e){ /* CORS possible, on ignore ce flux */ }
  }
  if(!all.length){
    $('#newsList').innerHTML="<li>Impossible de charger AFP/BBC (CORS). Essayez via un proxy serveur.</li>";
    $('#newsNote').textContent="Astuce : certains flux RSS n√©cessitent un proxy c√¥t√© serveur pour contourner CORS.";
    return;
  }
  // d√©dup + tri date desc
  const uniq = Object.values(all.reduce((acc,it)=>{
    const k=it.title.replace(/\s+/g,' ').trim();
    if(!acc[k] || acc[k].date<it.date) acc[k]=it;
    return acc;
  },{}));
  uniq.sort((a,b)=>b.date-a.date);
  $('#newsList').innerHTML = uniq.slice(0,8).map(i =>
    `<li><a href="${i.link}" target="_blank" rel="noopener">${i.title}</a> <span class="small">(${i.src})</span></li>`
  ).join("");
  $('#newsNote').textContent = "Sources : AFP, BBC ‚Äî derniers titres (d√©duplication & tri r√©cent).";
}

/* Refresh all */
function refreshAll(){loadAPOD();loadPOTD();loadESA();loadMet();loadEQ();loadSPX();loadWX();loadNews();}
$('#refreshBtn').onclick=refreshAll;
refreshAll();
</script>
</body>
</html>
